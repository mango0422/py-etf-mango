ì•ˆë…•í•˜ì„¸ìš”, ì—¬ëŸ¬ë¶„! ì˜¤ëŠ˜ì€ ì£¼ì‹ íˆ¬ìì— ë§¤ìš° ì¤‘ìš”í•œ ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ë°°ì›Œë³´ê² ìŠµë‹ˆë‹¤.

ì£¼ì‹ ì‹œì¥ì—ì„œëŠ” ë§¤ì¼ ìˆ˜ë§ì€ ë‰´ìŠ¤ê°€ ìŸì•„ì§‘ë‹ˆë‹¤. ì• í”Œ ê°™ì€ ëŒ€ê¸°ì—…ì€ í•˜ë£¨ì—ë„ ìˆ˜ì‹­, ìˆ˜ë°± ê±´ì˜ ê´€ë ¨ ê¸°ì‚¬ê°€ ë‚˜ì˜¤ëŠ”ë°ìš”, ì´ ëª¨ë“  ë‰´ìŠ¤ë¥¼ ì¼ì¼ì´ ì½ê³  ì¤‘ìš”ë„ë¥¼ íŒë‹¨í•˜ëŠ” ê±´ ì •ë§ ì–´ë ¤ìš´ ì¼ì´ì£ .

ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ íŒŒì´ì¬ê³¼ AIë¥¼ í™œìš©í•´ ê´€ë ¨ ë‰´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³ , ê·¸ì¤‘ì—ì„œ ê¸°ì—…ì˜ ì‹¤ì  ì „ë§ê³¼ ê´€ë ¨ì´ ë†’ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ë‰´ìŠ¤ë§Œ ê³¨ë¼ë‚´ëŠ” ë°©ë²•ì„ ë°°ì›Œë³¼ê²Œìš”!

## 1. í•„ìš”í•œ ì¤€ë¹„í•˜ê¸°

ë¨¼ì € í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  í™˜ê²½ ì„¤ì •ì„ í•´ì£¼ê² ìŠµë‹ˆë‹¤.

```python
# í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
import pandas as pd
import requests
import feedparser
import os
import urllib.parse
import pprint
import json

from pathlib import Path
from dotenv import load_dotenv
from openai import OpenAI
from datetime import datetime
from sec_cik_mapper import StockMapper
```

```python
load_dotenv()

openai_api_key = os.getenv("OPENAI_API_KEY")
openai_client = OpenAI(api_key=openai_api_key)

# ì‹œì¥ êµ¬ë¶„, ì¢…ëª©ì½”ë“œ ì§€ì • (ì˜ˆ: í•´ì™¸ ì‹œì¥ì˜ ì• í”Œ)
market = "ovs"  # ovs: í•´ì™¸, dom: êµ­ë‚´
stock_code = "AAPL"

# íŒŒì¼ ê²½ë¡œ ì„¤ì •
root_path = Path(__vsc_ipynb_file__).parent
data_path = root_path / "data"
report_path = root_path / "report"

# ê²½ë¡œ ìƒì„±
data_path.mkdir(parents=True, exist_ok=True)
report_path.mkdir(parents=True, exist_ok=True)
```

íŠ¹íˆ ì˜¤ëŠ˜ ìƒˆë¡­ê²Œ ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `feedparser`(í”¼ë“œíŒŒì„œ)ì˜ˆìš”. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì˜ RSS í”¼ë“œë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜í•´ ì‰½ê²Œ íŒŒì‹±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤. RSSëŠ” ë‰´ìŠ¤ë‚˜ ë¸”ë¡œê·¸ ë“±ì˜ ìµœì‹  ì½˜í…ì¸ ë¥¼ ë°°í¬í•˜ëŠ” í‘œì¤€ í˜•ì‹ì¸ë°ìš”, ë‹¤ìŒê³¼ ê°™ì´ ë‹¤ì–‘í•œ ë§¤ì²´ì—ì„œ ë°œí–‰í•˜ëŠ” ê¸°ì‚¬ì˜ ì œëª©, ë§í¬, ë‚ ì§œ, ë°œí–‰ ê¸°ê´€ ë“±ì˜ ì •ë³´ê°€ ë‹´ê²¨ìˆëŠ” íŒŒì¼ë¡œ êµ¬ì„±ì´ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

Google Newsì—ì„œë„ ì´ RSS í˜•ì‹ìœ¼ë¡œ ë‰´ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆì–´ìš”. êµ¬ì²´ì ìœ¼ë¡œ ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œ íŒŒì´ì¬ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ë²•ì€ ì ì‹œ í›„ì— ë°°ì›Œë³´ê² ìŠµë‹ˆë‹¤!

![image.png](attachment:f5a576f8-a678-4119-a1ef-f84bb2f97e62:image.png)

## 2. ë‰´ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

ì´ì œ Google Newsì—ì„œ ë‰´ìŠ¤ë¥¼ ê°€ì ¸ì™€ë³¼ê²Œìš”. ë¨¼ì € `StockMapper`ë¥¼ í™œìš©í•´ ì¢…ëª©ì½”ë“œë¥¼ ê¸°ì—…ëª…ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```python
stock_mapper = StockMapper()
company_name = stock_mapper.ticker_to_company_name[stock_code]
```

```
'Apple Inc.'
```

ì´ì œ ì´ ê¸°ì—…ëª…ì„ í‚¤ì›Œë“œë¡œ ì‚¬ìš©í•´ Google News RSS í”¼ë“œë¥¼ ìš”ì²­í•´ë³¼ê²Œìš”.

```python
# URL ì¸ì½”ë”©ìœ¼ë¡œ ê¸°ì—…ëª… ì²˜ë¦¬
encoded_company_name = urllib.parse.quote(company_name)  # URL ì¸ì½”ë”©

# ì‹œì¥ êµ¬ë¶„(market)ì— ë”°ë¼ ì–¸ì–´, êµ­ê°€ ì„¤ì •
if market == "dom": # êµ­ë‚´ -> í•œêµ­ì–´
    url = f"https://news.google.com/rss/search?q={encoded_company_name}&hl=ko&gl=KR&ceid=KR:ko"
else: # í•´ì™¸ -> ì˜ì–´
    url = f"https://news.google.com/rss/search?q={encoded_company_name}&hl=en-US&gl=US&ceid=US:en"
response = requests.get(url)
feed = feedparser.parse(response.text)
pprint.pprint(feed)
```

ë‹¤ì–‘í•œ ì •ë³´ë“¤ì´ ìˆì§€ë§Œ, ìš°ë¦¬ê°€ í•„ìš”í•œ ì •ë³´ëŠ” ë‰´ìŠ¤ì˜ ë°œí–‰ ë‚ ì§œ, ì œëª©, ì¶œì²˜, ë§í¬ì…ë‹ˆë‹¤. ì´ê²ƒë“¤ì„ ì¶”ì¶œí•´ì„œ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë§Œë“¤ì–´ ë³¼ê²Œìš”.

- ì½”ë“œ ë³€ê²½ ì‚¬í•­ (ë¦¬í™í† ë§)

  - before

    ```python
    news_list = []
    for entry in feed.entries:
        news_list.append({
            "datetime": datetime.strptime(entry.published, "%a, %d %b %Y %H:%M:%S %Z"),
            "title": entry.title,
            "source": entry.source.title if hasattr(entry, "source") else "Unknown",
            "link": entry.link
        })
    news_df = pd.DataFrame(news_list)

    if not news_df.empty:
        news_df.set_index("datetime", inplace=True)
        news_df.sort_index(inplace=True)  # ì‹œê°„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬

    # ë°ì´í„° ì €ì¥
    news_df.to_csv(data_path / f"{stock_code}.csv", index=True)
    ```

  - after

  ```python
  news_list = []
  for entry in feed.entries:
      published = datetime.strptime(entry.published,
                      "%a, %d %b %Y %H:%M:%S %Z")
      source = "Unknown"
      if hasattr(entry, "source"):
          source = entry.source.title

      news_list.append({
          "datetime": published,
          "title": entry.title,
          "source": source,
          "link": entry.link
      })
  news_df = pd.DataFrame(news_list)

  if not news_df.empty:
      news_df.set_index("datetime", inplace=True)
      # ì‹œê°„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
      news_df.sort_index(inplace=True)

  # ë°ì´í„° ì €ì¥
  news_df.to_csv(data_path / f"{stock_code}.csv",
                 index=True)
  ```

ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°í”„ë ˆì„ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ëœ ë‰´ìŠ¤ ê¸°ì‚¬ë“¤ì´ ë‹´ê¸°ê²Œ ë©ë‹ˆë‹¤.

![image.png](attachment:68889d27-7729-418f-ac1a-7b82cf33b6f1:image.png)

## 3. AI ê¸°ë³¸ ë¶„ì„: ì¤‘ìš” ë‰´ìŠ¤ ì¶”ì¶œí•˜ê¸°

êµ¬ê¸€ ë‰´ìŠ¤ í”¼ë“œì—ì„œëŠ” í•œ ë²ˆì— ìµœëŒ€ 100ê±´ì˜ ê¸°ì‚¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

ê·¸ ì¤‘ì—ì„œëŠ” íšŒì‚¬ì˜ ì‹¤ì  ì „ë§ê³¼ ë†’ì€ ê´€ë ¨ì´ ìˆì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ê²ƒë„ ìˆê³ , ì•„ë‹Œ ê²ƒë„ ìˆì„ ê²ë‹ˆë‹¤.

ì—¬ê¸°ì„œëŠ” ì‹¤ì  ì „ë§ê³¼ ê´€ë ¨ë„ê°€ ë†’ì€ ë‰´ìŠ¤ë§Œ ê³¨ë¼ë‚´ê¸° ìœ„í•´ AIë¥¼ í™œìš©í•´ ë³¼ê²Œìš”. ë¨¼ì € ë‰´ìŠ¤ ë°ì´í„°ë¥¼ JSON í˜•íƒœë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```python
news_json = news_df.to_json(orient="records", indent=4, force_ascii=False)
```

ê·¸ë¦¬ê³  ë¶„ì„ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•˜ê³ , OpenAI APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.

```python
prompt_news_dev = f"""ë‹¤ìŒì€ {company_name}ì— ëŒ€í•œ ìµœê·¼ ë‰´ìŠ¤ ê¸°ì‚¬ì…ë‹ˆë‹¤.
ì´ ì¤‘ {company_name}ì˜ í–¥í›„ ì‹¤ì ì— ê´€ë ¨ë„ê°€ ë†’ì€ ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ ëª‡ ê°€ì§€ ì„ ì •í•˜ê³ , ì¤‘ìš”í•œ ì´ìœ ì™€ í•¨ê»˜ ì¶œë ¥í•´ì£¼ì„¸ìš”."""

prompt_news_user = f"""ë‰´ìŠ¤ ê¸°ì‚¬(ë‚ ì§œ, ì œëª©, ì¶œì²˜, ë§í¬): {news_json}"""
```

- ì½”ë“œ ìˆ˜ì •

  - before

    ```python
    response = openai_client.chat.completions.create(
        model="o3-mini",
        messages=[
            {"role": "developer", "content": prompt_news_dev},
            {"role": "user", "content": prompt_news_user}
        ],
        reasoning_effort="low"
    )

    # ì‘ë‹µ ì €ì¥
    with open(report_path / f"{stock_code}_v1.md", "w", encoding="utf-8") as file:
        file.write(response.choices[0].message.content)
    ```

  - after

    ```python
    response = openai_client.chat.completions.create(
        model="o3-mini",
        messages=[
            {
                "role": "developer",
                "content": prompt_news_dev
            },
            {
                "role": "user",
                "content": prompt_news_user
            }
        ],
        reasoning_effort="low"
    )

    # ì‘ë‹µ ì €ì¥
    with open(report_path / f"{stock_code}_v1.md", "w",
              encoding="utf-8") as file:
        file.write(response.choices[0].message.content)
    ```

ì‘ë‹µì„ í™•ì¸í•´ë³´ë©´, ì£¼ìš” ë‰´ìŠ¤ë¥¼ 5ê°€ì§€ ì •ë„ ì„ ì •í•˜ê³  ê·¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì–´ìš”. ì˜ˆë¥¼ ë“¤ì–´ ì• í”Œì˜ ê²½ìš°, ëŒ€ê·œëª¨ ë¯¸êµ­ íˆ¬ì ê³„íš, ì‹ ì œí’ˆ ì¶œì‹œ ë“±ì˜ ì†Œì‹ì´ ì„ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.

```python
1. https://www.apple.com/newsroom/2025/02/apple-debuts-iphone-16e-a-powerful-new-member-of-the-iphone-16-family/

2. https://www.apple.com/newsroom/2025/03/apple-introduces-ipad-air-with-powerful-m3-chip-and-new-magic-keyboard/

3. https://www.reuters.com/technology/apple-launches-new-macbook-air-models-with-latest-m4-chip-2025-03-05/

4. https://www.apple.com/newsroom/2025/03/apple-unveils-new-mac-studio-the-most-powerful-mac-ever/

5. https://finance.yahoo.com/news/apple-inc-aapl-buying-back-144034309.html

6. https://www.apple.com/newsroom/2025/02/apple-will-spend-more-than-500-billion-usd-in-the-us-over-the-next-four-years/
```

```markdown
ì•„ë˜ ê¸°ì‚¬ë“¤ì€ Apple Inc.ì˜ í–¥í›„ ì‹¤ì ì— ì§ì ‘ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹  ê°€ëŠ¥ì„±ì´ í° ë‰´ìŠ¤ë¼ê³  íŒë‹¨ë©ë‹ˆë‹¤.

1. â€œApple debuts iPhone 16e: A powerful new member of the iPhone 16 family â€“ Apple Newsroomâ€  
   â€ƒâ€¢ ì¤‘ìš” ì´ìœ : ìƒˆë¡œìš´ ì•„ì´í° ëª¨ë¸ ì¶œì‹œëŠ” Appleì˜ ì£¼ë ¥ ì œí’ˆêµ° ì‹¤ì ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹˜ë©°, í–¥í›„ ë§¤ì¶œ ì„±ì¥ê³¼ ì‹œì¥ ì ìœ ìœ¨ í™•ëŒ€ì— ê¸°ì—¬í•  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

2. â€œApple introduces iPad Air with powerful M3 chip and new Magic Keyboard â€“ Apple Newsroomâ€  
   â€ƒâ€¢ ì¤‘ìš” ì´ìœ : ì°¨ì„¸ëŒ€ íƒœë¸”ë¦¿ ë° ì£¼ë³€ê¸°ê¸° ë¼ì¸ì—…ì€ ê¸°ì¡´ ìƒíƒœê³„ ê°•í™”ì™€ í•¨ê»˜ ìƒˆë¡œìš´ ì†Œë¹„ìì¸µ í™•ë³´ì— ì˜í–¥ì„ ì£¼ì–´ Appleì˜ ì‹¤ì  ê°œì„ ì— ê¸ì •ì ì¸ ì—­í• ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. â€œApple launches new MacBook Air models with latest M4 chip, cuts price â€“ Reutersâ€  
   â€ƒâ€¢ ì¤‘ìš” ì´ìœ : ê²½ìŸë ¥ ìˆëŠ” ë…¸íŠ¸ë¶ ì œí’ˆ ì¶œì‹œì™€ ê°€ê²© ì¸í•˜ëŠ” ì „ë¬¸ê°€ ë° ì†Œë¹„ì ì‹ ë¢°ë¥¼ ë†’ì—¬ í–¥í›„ PC ë° ë…¸íŠ¸ë¶ ë§¤ì¶œ ì¦ëŒ€ì— ê¸°ì—¬í•  ì „ë§ì…ë‹ˆë‹¤.

4. â€œApple unveils new Mac Studio, the most powerful Mac ever, featuring M4 Max and new M3 Ultra â€“ Apple Newsroomâ€  
   â€ƒâ€¢ ì¤‘ìš” ì´ìœ : í˜ì‹ ì ì¸ ë°ìŠ¤í¬íƒ‘ ì œí’ˆ ë°œí‘œëŠ” ê³ ì„±ëŠ¥ ì‹œì¥ì—ì„œ Appleì˜ ì…ì§€ë¥¼ ê²¬ê³ íˆ í•˜ê³ , ì „ë¬¸ ì‚¬ìš©ì ë° ê¸°ì—… ìˆ˜ìš”ë¥¼ ì¦ëŒ€ì‹œì¼œ ì‹¤ì ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

5. â€œIs Apple Inc. (AAPL) Buying Back Its Stock in 2025? â€“ Yahoo Financeâ€  
   â€ƒâ€¢ ì¤‘ìš” ì´ìœ : ìì‚¬ì£¼ ë§¤ì… ê³„íšì€ ì£¼ì£¼ í™˜ì› ì •ì±…ì˜ ì¼í™˜ìœ¼ë¡œ, ì£¼ê°€ ë° íˆ¬ìì ì‹ ë¢°ì— ê¸ì •ì  ì˜í–¥ì„ ë¯¸ì³ ì¥ê¸°ì  ì‹¤ì  ê°œì„  ì „ë§ì— ê¸°ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

6. â€œApple will spend more than $500 billion in the U.S. over the next four years â€“ Apple Newsroomâ€  
   â€ƒâ€¢ ì¤‘ìš” ì´ìœ : ëŒ€ê·œëª¨ ë¯¸êµ­ íˆ¬ì ê³„íšì€ ìƒì‚° ë° R&D ì—­ëŸ‰ ê°•í™”ì— ë”°ë¥¸ ê¸°ìˆ  ê²½ìŸë ¥ í™•ë³´ì™€ ë¯¸ë˜ ì„±ì¥ ë™ë ¥ ì°½ì¶œì— ë„ì›€ì„ ì¤„ ê°€ëŠ¥ì„±ì´ ìˆì–´, ì¥ê¸°ì ì¸ ì‹¤ì  ì „ë§ì— í° ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.

ì´ì™€ ê°™ì€ ì œí’ˆ ì¶œì‹œ, íˆ¬ì ê³„íš, ì£¼ì£¼ í™˜ì› ì •ì±… ë“±ì€ ê°ê° í˜ì‹ ì„±, ì‹œì¥ ê²½ìŸë ¥, ì¬ë¬´ ê±´ì „ì„± ì¸¡ë©´ì—ì„œ Appleì˜ ë¯¸ë˜ ì‹¤ì ì— ìƒë‹¹í•œ ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.
```

í•˜ì§€ë§Œ ì´ëŸ° ê°„ë‹¨í•œ ë¶„ì„ì—ëŠ” ëª‡ ê°€ì§€ ì•„ì‰¬ìš´ ì ì´ ìˆìŠµë‹ˆë‹¤.

1. ë¨¼ì €, ë¹„ìŠ·í•œ ë‚´ìš©ì„ ë‹¤ë£¬ ì—¬ëŸ¬ ë‰´ìŠ¤ë¥¼ ì¤‘ë³µìœ¼ë¡œ ì„ ì •í•˜ëŠ” ê²½ìš°ê°€ ìˆë„¤ìš”.
2. ê·¸ë¦¬ê³ , ê° ë‰´ìŠ¤ê°€ ê¸°ì—…ì˜ ì‹¤ì  ì „ë§ì— ê¸ì •ì ì¸ì§€ ë¶€ì •ì ì¸ì§€ í•œ ëˆˆì— ì•Œì•„ë³´ê¸° ì‰½ê²Œ ë˜ë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
3. ë§ˆì§€ë§‰ìœ¼ë¡œ ë‰´ìŠ¤ ì œëª©ì´ ì‚´ì§ ë³€í˜•ë˜ëŠ” ê²½ìš°ë„ ìˆì–´ì„œ, ìµœì¢… ê²°ê³¼ë¥¼ ì •ë¹„í•˜ëŠ” ë‹¨ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## 4. AI ì‹¬í™” ë¶„ì„: ê°ì„± ë¶„ì„ê³¼ êµ¬ì¡°í™”ëœ ì¶œë ¥

ê·¸ë˜ì„œ ì´ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê³ , ê°ì„±ë¶„ì„(sentiment analysis)ì´ë¼ëŠ” ê¸°ë²•ì„ ë„ì…í•´ ë” ë°œì „ëœ ë¶„ì„ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.

ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ì—ì„œëŠ”

1. ì¤‘ë³µëœ ì£¼ì œëŠ” í•˜ë‚˜ë§Œ ì„ íƒí•˜ë„ë¡ ëª…ì‹œí•´ì¤„ê²Œìš”.
2. ê·¸ë¦¬ê³  ë‰´ìŠ¤ì˜ ë‚´ìš©ì´ íšŒì‚¬ ì „ë§ì— ê¸ì •ì ì¸ì§€, ë¶€ì •ì ì¸ì§€ ë¶„ì„í•˜ê³  í‘œì‹œí•  ê±°ì˜ˆìš”.
3. ì´ ëª¨ë“  ê²°ê³¼ëŠ” ë¯¸ë¦¬ ì •ì˜í•œ ê¹”ë”í•œ êµ¬ì¡°ë¡œ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.
   1. ì´ë•Œ ê° í•„ë“œì— í•„ìš”í•œ ë‚´ìš©ì„ ëª¨ë‘ ì ì–´ì£¼ì—ˆê³ , íŠ¹íˆ ì „ì²´ ì ìˆ˜ ê³„ì‚° ë°©ì‹ì— ëŒ€í•´ì„œëŠ” ì˜ˆì‹œë¥¼ í¬í•¨í•˜ì—¬ ì •í™•í•œ ìˆ˜ì¹˜ ê³„ì‚°ì´ ì´ë£¨ì–´ì§€ë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```python
# í”„ë¡¬í”„íŠ¸ ì‘ì„±
prompt_news_dev_2 = f"""ë‹¤ìŒì€ {company_name}ì— ëŒ€í•œ ìµœê·¼ ë‰´ìŠ¤ ê¸°ì‚¬ì…ë‹ˆë‹¤.
ì œëª©ì„ ì‚´í´ë³´ê³  ê°ì„± ë¶„ì„ì„ í†µí•´ {company_name}ì˜ í–¥í›„ ì‹¤ì ì— ê¸ì •ì /ë¶€ì •ì  ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ 4ê±´ ì´ìƒ ì„ ì •í•˜ê³  ê·¸ ì´ìœ ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.
ê°™ì€ ì£¼ì œì˜ ê¸°ì‚¬ë¥¼ ì—¬ëŸ¬ ê°œ ê³¨ëë‹¤ë©´ ê·¸ ì¤‘ í•˜ë‚˜ë§Œ ì„ ì •í•´ì£¼ì„¸ìš”. ì¶œì²˜ì˜ ì‹ ë¢°ì„±ê³¼ ì¤‘ë¦½ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„ ì •í•˜ë˜, ê¸ì •ì , ë¶€ì •ì  ì†Œì‹ì„ ê³¨ê³ ë£¨ ê²€í† í•´ì£¼ì„¸ìš”.

ë¶„ì„ ê²°ê³¼ëŠ” ì£¼ì–´ì§„ JSON ìŠ¤í‚¤ë§ˆì— ë§ì¶°, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ í¬í•¨í•©ë‹ˆë‹¤.

'index' í•„ë“œì—ëŠ” ì£¼ì–´ì§„ ë‰´ìŠ¤ ë°ì´í„°ì—ì„œ í•´ë‹¹ ê¸°ì‚¬ì˜ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
'title' í•„ë“œì—ëŠ” ê¸°ì‚¬ì˜ ì œëª©ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì›ë³¸ ì œëª©ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
'reason' í•„ë“œì—ëŠ” íˆ¬ììì˜ ê´€ì ì—ì„œ í•´ë‹¹ ê¸°ì‚¬ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ì´ìœ ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.
'sentiment' í•„ë“œì—ëŠ” ê¸°ì‚¬ì˜ ê°ì„±ì„ 'ê¸ì •', 'ë¶€ì •', 'ì¤‘ë¦½'ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³ , ê°ê°ì— ì ì ˆí•œ emojiì™€ í•¨ê»˜ ë°˜í™˜í•©ë‹ˆë‹¤.
'overall_sentiment' í•„ë“œì—ëŠ” ëª¨ë“  ê¸°ì‚¬ì˜ ê°ì„±ì„ í‰ê· ë‚´ì–´ ì „ì²´ì ì¸ ê°ì„±ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ê°ì„± ì ìˆ˜ëŠ” -5 (ë§¤ìš° ë¶€ì •ì : ëŒ€ë¶€ë¶„ì˜ ê¸°ì‚¬ê°€ ë¶€ì •ì )ì—ì„œ 5 (ë§¤ìš° ê¸ì •ì : ëŒ€ë¶€ë¶„ì˜ ê¸°ì‚¬ê°€ ê¸ì •ì ) ì‚¬ì´ì˜ ì •ìˆ˜ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ì´ 4ê±´ì˜ ê¸°ì‚¬ë¥¼ ì„ ì •í–ˆì„ ë•Œ ê¸°ì‚¬ 2ê±´ì„ 'ê¸ì •', 1ê±´ì„ 'ì¤‘ë¦½', ë‹¤ë¥¸ 1ê±´ì„ 'ë¶€ì •'ìœ¼ë¡œ ë¶„ë¥˜í–ˆë‹¤ê³  í•©ì‹œë‹¤. ì´ ë•Œ ì „ì²´ í‰ê°€ ì ìˆ˜ëŠ” (5 + 5 + 0 - 5) / 4 = 1.25, ë°˜ì˜¬ë¦¼í•˜ì—¬ 2ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
'sentiment_emoji' í•„ë“œì—ëŠ” ì „ì²´ì ì¸ ê°ì„±ì„ 'ğŸŸ¢', 'ğŸ”´', 'ğŸŸ¡'ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ê°ê°ì€ ê¸ì •, ë¶€ì •, ì¤‘ë¦½ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ëª¨ë“  ë‚´ìš©ì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”."""

prompt_news_user = f"""ë‰´ìŠ¤ ê¸°ì‚¬ ëª©ë¡(ë‚ ì§œ, ì œëª©, ì¶œì²˜, ë§í¬): {news_json}"""
```

ì´ì œ ê·¸ë™ì•ˆ í–ˆë˜ ê²ƒì²˜ëŸ¼ í¬ë§·íŒ…ë„ ì ìš©í•˜ê² ìŠµë‹ˆë‹¤.

í˜•ì‹ ìŠ¤í‚¤ë§ˆë¥¼ ì§€ì •í•˜ê³ ,

```json
news_format = {
    "type": "json_schema",
    "json_schema": {
        "name": "news_analysis",
        "schema": {
            "type": "object",
            "properties": {
                "articles": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "index": {"type": "integer"},
                            "title": {"type": "string"},
                            "reason": {"type": "string"},
                            "sentiment": {
                                "type": "string",
                            },
                        },
                        "required": [
                            "index", "title",
                            "reason", "sentiment"
                        ],
                        "additionalProperties": False,
                    },
                },
                "overall_sentiment": {
                    "type": "integer"
                },
                "sentiment_emoji": {
                    "type": "string",
                    "enum": ["ğŸŸ¢", "ğŸ”´", "ğŸŸ¡"],
                },
            },
            "required": [
                "articles",
                "overall_sentiment",
                "sentiment_emoji"
            ],
            "additionalProperties": False,
        },
    },
}
```

APIë¥¼ í˜¸ì¶œí•˜ê³ ,

```python
response = openai_client.chat.completions.create(
    model="o3-mini",
    messages=[
        {"role": "developer", "content": prompt_news_dev_2},
        {"role": "user", "content": prompt_news_user}
    ],
    reasoning_effort="low",
    response_format=news_format
)
```

AIì˜ ì‘ë‹µì„ íŒŒì‹±í•´ì„œ ë³´ê¸° ì¢‹ì€ ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œë¡œ ë§Œë“­ë‹ˆë‹¤.

- ì½”ë“œ ìˆ˜ì •

  - before

    ```python
    # ì‘ë‹µ íŒŒì‹±
    analysis = json.loads(response.choices[0].message.content)
    article_list = analysis['articles'] if isinstance(analysis['articles'], list) else [analysis['articles']]

    # ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ íŒŒì‹±: ì¸íŠ¸ë¡œ
    report_md = f"# {company_name} ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤ {len(article_list)}ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤.\\n\\n"
    overall_sentiment = f'+{analysis["overall_sentiment"]}' if analysis["overall_sentiment"] >= 0 else f'{analysis["overall_sentiment"]}'
    report_md += f"### ì „ì²´ ë‰´ìŠ¤ ê°ì„±: {overall_sentiment} {analysis['sentiment_emoji']}\\n\\n"
    report_md += "---\\n\\n"
    ```

  - after

  ```python
  # ì‘ë‹µ íŒŒì‹±
  analysis = json.loads(response.choices[0].message.content)
  article_list = analysis['articles']
  if not isinstance(article_list, list):
      article_list = [article_list]

  # ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ íŒŒì‹±: ì¸íŠ¸ë¡œ
  overall_sentiment = analysis["overall_sentiment"]
  if overall_sentiment >= 0:
      overall_sentiment = f"+{overall_sentiment}"

  report_md = f"# {company_name} ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤"
  report_md += f"{len(article_list)}ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤.\n\n"
  report_md += f"### ì „ì²´ ë‰´ìŠ¤ ê°ì„±: {overall_sentiment}"
  report_md += f"{analysis['sentiment_emoji']}\n\n"
  report_md += "---\n\n"
  ```

ì´ ë•Œ, ê° ê¸°ì‚¬ë³„ë¡œ ì›ë³¸ ë§í¬ë¥¼ ì°¾ì•„ ë§¤ì¹­ì‹œì¼œì¤ë‹ˆë‹¤.

ìš”ì•½ ë³´ê³ ì„œë¥¼ ë¨¼ì € ë³´ê³ , ê¸°ì‚¬ ì „ë¬¸ì„ ë³´ê³  ì‹¶ìœ¼ë©´ ë§í¬ë¡œ ì´ë™í•´ ì§ì ‘ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê±°ì£ .

- ì½”ë“œ ìˆ˜ì • (ë¦¬í™í† ë§)

  - before

    ```python
    # ë³´ê³ ì„œ íŒŒì‹±: ë³¸ë¬¸
    for article in article_list:
        article_title = article['title']

        # ì œëª©-ë§í¬ ë§¤ì¹­
        if article_title in news_df['title'].values:
            # ì¼ì¹˜í•˜ëŠ” ì œëª© ìˆì„ ê²½ìš°
            article_link = news_df[news_df['title'] == article_title]['link'].values[0]
        else:
            # ì¼ì¹˜í•˜ëŠ” ì œëª© ì—†ì„ ê²½ìš°, ê²€ìƒ‰ìœ¼ë¡œ ì°¾ê¸°
            encoded_title = urllib.parse.quote(article_title)
            # ì‹œì¥ êµ¬ë¶„ì— ë”°ë¼ ê²€ìƒ‰ ì–¸ì–´ ì„¤ì •
            url = f"<https://news.google.com/rss/search?q={encoded_title}&hl=en-US&gl=US&ceid=US:en>" if market == "ovs" else f"<https://news.google.com/rss/search?q={encoded_title}&hl=ko&gl=KR&ceid=KR:ko>"
            response = requests.get(url)
            feed = feedparser.parse(response.text)
            article_link = feed.entries[0].link if feed.entries else "#"

        # ë³´ê³ ì„œì— ì¶”ê°€
        report_md += f"### [{article_title}]({article_link})\\n"
        report_md += f"**ê°ì„±**: {article['sentiment']}\\n\\n"
        report_md += f"**ì„ ì • ì´ìœ **: {article['reason']}\\n\\n"
        report_md += "---\\n\\n"

    # ê²°ê³¼ ì €ì¥
    with open(report_path / f"{stock_code}_v2.md", "w", encoding="utf-8") as file:
        file.write(report_md)

    ```

  - after

    ```python
    # ë³´ê³ ì„œ íŒŒì‹±: ë³¸ë¬¸
    for article in article_list:
        article_title = article['title']
        match = news_df[news_df['title'] == article_title]

        article_link = "#"
        if not match.empty:
            # ì œëª©-ë§í¬ ë§¤ì¹­
            article_link = match['link'].values[0]
        else:
            # ì¼ì¹˜í•˜ëŠ” ì œëª© ì—†ì„ ê²½ìš°, ê²€ìƒ‰ìœ¼ë¡œ ì°¾ê¸°
            encoded_title = urllib.parse.quote(article_title)
            # ì‹œì¥ êµ¬ë¶„ì— ë”°ë¼ ê²€ìƒ‰ ì–¸ì–´ ì„¤ì •
            url = f"<https://news.google.com/rss/search?q={encoded_title}&hl=en-US&gl=US&ceid=US:en>" if market == "ovs" else f"<https://news.google.com/rss/search?q={encoded_title}&hl=ko&gl=KR&ceid=KR:ko>"
            response = requests.get(url)
            feed = feedparser.parse(response.text)

            if feed.entries:1
                article_link = feed.entries[0].link

        # ë³´ê³ ì„œì— ì¶”ê°€
        report_md += f"### [{article_title}]({article_link})\n"
        report_md += f"**ê°ì„±**: {article['sentiment']}\n\n"
        report_md += f"**ì„ ì • ì´ìœ **: {article['reason']}\n\n"
        report_md += "---\n\n"

    # ê²°ê³¼ ì €ì¥
    with open(report_path / f"{stock_code}_v2.md", "w",
              encoding="utf-8") as file:
        file.write(report_md)
    ```

## 5. ê²°ê³¼ í™•ì¸í•˜ê¸°

ìµœì¢… ê²°ê³¼ë¬¼ì„ í™•ì¸í•´ë³¼ê¹Œìš”? ì• í”Œì— ëŒ€í•´ ìƒì„±í•œ ë³´ê³ ì„œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤!

```markdown
# Apple Inc. ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤ 4ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤.

### ì „ì²´ ë‰´ìŠ¤ ê°ì„±: +0 ğŸŸ¡

---

### [Apple debuts iPhone 16e: A powerful new member of the iPhone 16 family - Apple Newsroom](<https://news.google.com/>...)

**ê°ì„±**: ê¸ì • ğŸŸ¢

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” ìƒˆë¡œìš´ iPhone ëª¨ë¸ì„ ë°œí‘œí•¨ìœ¼ë¡œì¨ Appleì˜ ì œí’ˆ ë¼ì¸ì—…ì´ ê°•í™”ë˜ê³  ì†Œë¹„ìë“¤ì˜ ê´€ì‹¬ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¬ ê°€ëŠ¥ì„±ì´ ìˆì–´ í–¥í›„ ì‹¤ì ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.

---

### [Apple will spend more than $500 billion in the U.S. over the next four years - Apple Newsroom](<https://news.google.com/>...)

**ê°ì„±**: ê¸ì • ğŸŸ¢

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” ë¯¸êµ­ ë‚´ì—ì„œ ëŒ€ê·œëª¨ íˆ¬ìë¥¼ ì§„í–‰í•œë‹¤ëŠ” ì†Œì‹ìœ¼ë¡œ, Appleì˜ ì„±ì¥ ì „ëµê³¼ ì‹œì¥ í™•ëŒ€ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ì˜ì§€ë¥¼ ë³´ì—¬ì£¼ì–´ íˆ¬ììë“¤ì—ê²Œ ê¸ì •ì ì¸ ì‹ í˜¸ë¡œ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### [Apple Delays Siri Upgrade Indefinitely as AI Concerns Escalate - Bloomberg](<https://news.google.com/>...)

**ê°ì„±**: ë¶€ì • ğŸ”´

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” Siriì˜ AI ì—…ê·¸ë ˆì´ë“œê°€ ë¬´ê¸°í•œ ì—°ê¸°ëœë‹¤ëŠ” ì†Œì‹ìœ¼ë¡œ, Appleì˜ ì¸ê³µì§€ëŠ¥ ê²½ìŸë ¥ ê°•í™”ì— ì°¨ì§ˆì´ ìˆì„ ìˆ˜ ìˆìŒì„ ì‹œì‚¬í•˜ì—¬ ë‹¨ê¸°ì ìœ¼ë¡œ ë¶€ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹  ìš°ë ¤ê°€ ìˆìŠµë‹ˆë‹¤.

---

### [Apple Crippled By AI Failure - 24/7 Wall St.](<https://news.google.com/>...)

**ê°ì„±**: ë¶€ì • ğŸ”´

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” Appleì´ ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì—ì„œ ì‹¤íŒ¨ë¥¼ ê²ªê³  ìˆë‹¤ëŠ” ë‚´ìš©ì„ ë‹¤ë£¨ê³  ìˆìœ¼ë©°, ê¸°ìˆ  í˜ì‹ ì— ì‹¤íŒ¨í•  ê²½ìš° íˆ¬ì ì‹¬ë¦¬ì— ë¶€ì •ì ì¸ ì˜í–¥ì„ ë¼ì¹  ìˆ˜ ìˆì–´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

---
```

ë³´ì‹œë‹¤ì‹œí”¼, ì¤‘ìš”í•œ ë‰´ìŠ¤ë“¤ì„ ì„ ë³„í•˜ê³ , ê° ë‰´ìŠ¤ê°€ í–¥í›„ ì‹¤ì ì— ë¯¸ì¹  ì˜í–¥ê³¼ ê·¸ ì´ìœ ê¹Œì§€ ë¶„ì„í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì „ë§ì— ê¸ì •ì ì¸ ì†Œì‹ê³¼ ë‹¤ì†Œ ìš°ë ¤ìŠ¤ëŸ¬ìš´ ì†Œì‹ì„ ì¢…í•©í•˜ì—¬ ì „ì²´ ê°ì„±ì„ ìš”ì•½í•˜ëŠ” ê¸°ëŠ¥ë„ ì˜ í•´ì£¼ê³  ìˆë„¤ìš”.

## 6. ë§ˆë¬´ë¦¬

ì´ì œ ìš°ë¦¬ëŠ” ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³ , AIë¥¼ í™œìš©í•´ ì¤‘ìš”í•œ ë‰´ìŠ¤ë¥¼ ì„ ë³„í•˜ê³  ê°ì„± ë¶„ì„ê¹Œì§€ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!

ì´ì „ì— ë°°ìš´ ì°¨íŠ¸ ë¶„ì„, ì¬ë¬´ì œí‘œ ë¶„ì„ê³¼ í•¨ê»˜ ì´ëŸ° ë‰´ìŠ¤ ë¶„ì„ê¹Œì§€ í™œìš©í•˜ë©´ íˆ¬ì ê²°ì •ì— ë”ìš± í’ë¶€í•œ ì •ë³´ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°•ì˜ í›„ë°˜ë¶€ì˜ â€˜ìµœì¢… ì‹œìŠ¤í…œ êµ¬ì¶•â€™ ë‹¨ê³„ì—ì„œëŠ” ì´ ì„¸ ê°€ì§€ ë¶„ì„ ê²°ê³¼ë¥¼ í•œ ëˆˆì— ë³¼ ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œì„ ê°œë°œí•˜ê²Œ ë˜ë‹ˆ, ì´ ë¶€ë¶„ë„ ê¸°ëŒ€í•´ì£¼ì„¸ìš”.

ê·¸ëŸ¼ ë‹¤ìŒ ì‹œê°„ì— ë” ì¬ë°Œê³  ìœ ìš©í•œ ë‚´ìš©ìœ¼ë¡œ ëµ™ê² ìŠµë‹ˆë‹¤!

--

### 1ï¸âƒ£ ë‰´ìŠ¤ ë¶„ì„ì˜ ì¤‘ìš”ì„±ê³¼ í™˜ê²½ ì„¤ì •

- ì£¼ì‹ ì‹œì¥ì—ì„œëŠ” ë§¤ì¼ ìˆ˜ë§ì€ ë‰´ìŠ¤ê°€ ë°œí–‰ë˜ë©°, ì´ ì¤‘ ê¸°ì—… ì‹¤ì ì— ì˜í–¥ì„ ë¯¸ì¹  ë‰´ìŠ¤ë¥¼ ì¶”ë ¤ë‚´ëŠ” ì‘ì—…ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
- ë‰´ìŠ¤ ë°ì´í„° ìˆ˜ì§‘ì—ëŠ” feedparser ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í™œìš©ë©ë‹ˆë‹¤.
  - ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” RSS í”¼ë“œë¥¼ íŒŒì‹±í•˜ì—¬ ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ì‰½ê²Œ ìˆ˜ì§‘í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
  - RSSëŠ” ë‰´ìŠ¤ë‚˜ ë¸”ë¡œê·¸ ë“±ì˜ ìµœì‹  ì½˜í…ì¸ ë¥¼ ë°°í¬í•˜ëŠ” í‘œì¤€ í˜•ì‹ì…ë‹ˆë‹¤.
- í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.

```python
# í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
import pandas as pd
import requests
import feedparser
import os
import urllib.parse
import pprint
import json

from pathlib import Path
from dotenv import load_dotenv
from openai import OpenAI
from datetime import datetime
from sec_cik_mapper import StockMapper

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œí•˜ê¸°
load_dotenv()

openai_api_key = os.getenv("OPENAI_API_KEY")
openai_client = OpenAI(api_key=openai_api_key)

# ì‹œì¥ êµ¬ë¶„, ì¢…ëª©ì½”ë“œ ì§€ì •í•˜ê¸°
market = "ovs"# ovs: í•´ì™¸, dom: êµ­ë‚´
stock_code = "AAPL"

# íŒŒì¼ ê²½ë¡œ ì„¤ì •í•˜ê¸°
root_path = Path(__vsc_ipynb_file__).parent
data_path = root_path / "data"
report_path = root_path / "report"

# ê²½ë¡œ ìƒì„±í•˜ê¸°
data_path.mkdir(parents=True, exist_ok=True)
report_path.mkdir(parents=True, exist_ok=True)
```

<aside>
â•

**RSS(Really Simple Syndication)**

- RSSëŠ” ì›¹ì‚¬ì´íŠ¸ì˜ ì—…ë°ì´íŠ¸ëœ ì •ë³´ë¥¼ í‘œì¤€í™”ëœ í˜•ì‹ìœ¼ë¡œ ì œê³µí•˜ëŠ” XML ê¸°ë°˜ì˜ í¬ë§·ì…ë‹ˆë‹¤. - RSS í”¼ë“œë¥¼ í†µí•´ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ì›¹ì‚¬ì´íŠ¸ì˜ ìµœì‹  ì½˜í…ì¸ ë¥¼ í•œ ê³³ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. - Google Newsì™€ ê°™ì€ ë‰´ìŠ¤ ì›¹ì‚¬ì´íŠ¸ëŠ” RSSë¥¼ í†µí•´ ë‹¤ì–‘í•œ ì¶œì²˜ì˜ ë‰´ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ê³  ì œê³µí•©ë‹ˆë‹¤.
</aside>

### 2ï¸âƒ£ Google Newsì—ì„œ ë‰´ìŠ¤ ë°ì´í„° ìˆ˜ì§‘í•˜ê¸°

- ì¢…ëª©ì½”ë“œë¥¼ ê¸°ì—…ëª…ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ê²€ìƒ‰ í‚¤ì›Œë“œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

```python
# ì¢…ëª©ì½”ë“œë¥¼ ê¸°ì—…ëª…ìœ¼ë¡œ ë³€í™˜í•˜ê¸°
stock_mapper = StockMapper()
company_name = stock_mapper.ticker_to_company_name[stock_code]
```

- Google News RSS í”¼ë“œë¥¼ í†µí•´ ê¸°ì—… ê´€ë ¨ ë‰´ìŠ¤ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.

```python
# URL ì¸ì½”ë”©ìœ¼ë¡œ ê¸°ì—…ëª… ì²˜ë¦¬í•˜ê¸°
encoded_company_name = urllib.parse.quote(company_name)

# ì‹œì¥ êµ¬ë¶„ì— ë”°ë¼ ì–¸ì–´, êµ­ê°€ ì„¤ì •í•˜ê¸°
if market == "dom":# êµ­ë‚´ -> í•œêµ­ì–´
    url = f"https://news.google.com/rss/search?q={encoded_company_name}&hl=ko&gl=KR&ceid=KR:ko"
else:# í•´ì™¸ -> ì˜ì–´
    url = f"https://news.google.com/rss/search?q={encoded_company_name}&hl=en-US&gl=US&ceid=US:en"

# RSS í”¼ë“œ ìš”ì²­í•˜ê¸°
response = requests.get(url)
feed = feedparser.parse(response.text)
```

- ìˆ˜ì§‘í•œ ë‰´ìŠ¤ì—ì„œ ë°œí–‰ ë‚ ì§œ, ì œëª©, ì¶œì²˜, ë§í¬ë¥¼ ì¶”ì¶œí•˜ì—¬ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.

```python
# ë‰´ìŠ¤ ë°ì´í„° ì¶”ì¶œí•˜ê¸°
news_list = []
for entry in feed.entries:
    published = datetime.strptime(entry.published,
                    "%a, %d %b %Y %H:%M:%S %Z")
    source = "Unknown"
    if hasattr(entry, "source"):
        source = entry.source.title

    news_list.append({
        "datetime": published,
        "title": entry.title,
        "source": source,
        "link": entry.link
    })

# ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ê¸°
news_df = pd.DataFrame(news_list)

if not news_df.empty:
    news_df.set_index("datetime", inplace=True)
    # ì‹œê°„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•˜ê¸°
    news_df.sort_index(inplace=True)

# ë°ì´í„° ì €ì¥í•˜ê¸°
news_df.to_csv(data_path / f"{stock_code}.csv", index=True)
```

<aside>
âš ï¸

**ì—¬ê¸°ì„œ ì ê¹!**

- URL ì¸ì½”ë”©ì€ URLì— ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë¬¸ì(ê³µë°±, íŠ¹ìˆ˜ë¬¸ì ë“±)ë¥¼ ì•ˆì „í•œ ë¬¸ìë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, ê³µë°±ì€ '%20'ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.
  - ê¸°ì—…ëª…ì— íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ëœ ê²½ìš° ì¸ì½”ë”©ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
- ì¸ì½”ë”© ì—†ì´ URLì— íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ë©´ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</aside>

### 3ï¸âƒ£ AI ë‰´ìŠ¤ ë¶„ì„: ì¤‘ìš” ë‰´ìŠ¤ ì¶”ì¶œí•˜ê¸°

- ìˆ˜ì§‘í•œ ë‰´ìŠ¤ ë°ì´í„°ë¥¼ JSON í˜•íƒœë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```python
# ë‰´ìŠ¤ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ê¸°
news_json = news_df.to_json(orient="records", indent=4, force_ascii=False)
```

- ê¸°ì—… ì‹¤ì ì— ê´€ë ¨ë„ê°€ ë†’ì€ ë‰´ìŠ¤ë¥¼ ì„ ë³„í•˜ê¸° ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```python
# í”„ë¡¬í”„íŠ¸ ì‘ì„±í•˜ê¸°
prompt_news_dev = f"""ë‹¤ìŒì€ {company_name}ì— ëŒ€í•œ ìµœê·¼ ë‰´ìŠ¤ ê¸°ì‚¬ì…ë‹ˆë‹¤.
ì´ ì¤‘ {company_name}ì˜ í–¥í›„ ì‹¤ì ì— ê´€ë ¨ë„ê°€ ë†’ì€ ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ ëª‡ ê°€ì§€ ì„ ì •í•˜ê³ , ì¤‘ìš”í•œ ì´ìœ ì™€ í•¨ê»˜ ì¶œë ¥í•´ ì£¼ì„¸ìš”."""

prompt_news_user = f"""ë‰´ìŠ¤ ê¸°ì‚¬(ë‚ ì§œ, ì œëª©, ì¶œì²˜, ë§í¬): {news_json}"""
```

- OpenAI APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì¤‘ìš” ë‰´ìŠ¤ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

```python
# OpenAI API í˜¸ì¶œí•˜ê¸°
response = openai_client.chat.completions.create(
    model="o3-mini",
    messages=[
        {
            "role": "developer",
            "content": prompt_news_dev
        },
        {
            "role": "user",
            "content": prompt_news_user
        }
    ],
    reasoning_effort="low"
)

# ì‘ë‹µ ì €ì¥í•˜ê¸°
with open(report_path / f"{stock_code}_v1.md", "w", encoding="utf-8") as file:
    file.write(response.choices[0].message.content)
```

- ìƒì„± ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

```markdown
ì•„ë˜ ê¸°ì‚¬ë“¤ì€ Apple Inc.ì˜ í–¥í›„ ì‹¤ì ì— ì§ì ‘ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹  ê°€ëŠ¥ì„±ì´ í° ë‰´ìŠ¤ë¼ê³  íŒë‹¨ë©ë‹ˆë‹¤.

1. â€œApple debuts iPhone 16e: A powerful new member of the iPhone 16 family â€“ Apple Newsroomâ€  
   â€ƒ- ì¤‘ìš” ì´ìœ : ìƒˆë¡œìš´ ì•„ì´í° ëª¨ë¸ ì¶œì‹œëŠ” Appleì˜ ì£¼ë ¥ ì œí’ˆêµ° ì‹¤ì ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹˜ë©°, í–¥í›„ ë§¤ì¶œ ì„±ì¥ê³¼ ì‹œì¥ ì ìœ ìœ¨ í™•ëŒ€ì— ê¸°ì—¬í•  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

2. â€œApple introduces iPad Air with powerful M3 chip and new Magic Keyboard â€“ Apple Newsroomâ€  
   â€ƒ- ì¤‘ìš” ì´ìœ : ì°¨ì„¸ëŒ€ íƒœë¸”ë¦¿ ë° ì£¼ë³€ê¸°ê¸° ë¼ì¸ì—…ì€ ê¸°ì¡´ ìƒíƒœê³„ ê°•í™”ì™€ í•¨ê»˜ ìƒˆë¡œìš´ ì†Œë¹„ìì¸µ í™•ë³´ì— ì˜í–¥ì„ ì£¼ì–´ Appleì˜ ì‹¤ì  ê°œì„ ì— ê¸ì •ì ì¸ ì—­í• ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. â€œApple launches new MacBook Air models with latest M4 chip, cuts price â€“ Reutersâ€  
   â€ƒ- ì¤‘ìš” ì´ìœ : ê²½ìŸë ¥ ìˆëŠ” ë…¸íŠ¸ë¶ ì œí’ˆ ì¶œì‹œì™€ ê°€ê²© ì¸í•˜ëŠ” ì „ë¬¸ê°€ ë° ì†Œë¹„ì ì‹ ë¢°ë¥¼ ë†’ì—¬ í–¥í›„ PC ë° ë…¸íŠ¸ë¶ ë§¤ì¶œ ì¦ëŒ€ì— ê¸°ì—¬í•  ì „ë§ì…ë‹ˆë‹¤.

4. â€œApple unveils new Mac Studio, the most powerful Mac ever, featuring M4 Max and new M3 Ultra â€“ Apple Newsroomâ€  
   â€ƒ- ì¤‘ìš” ì´ìœ : í˜ì‹ ì ì¸ ë°ìŠ¤í¬íƒ‘ ì œí’ˆ ë°œí‘œëŠ” ê³ ì„±ëŠ¥ ì‹œì¥ì—ì„œ Appleì˜ ì…ì§€ë¥¼ ê²¬ê³ íˆ í•˜ê³ , ì „ë¬¸ ì‚¬ìš©ì ë° ê¸°ì—… ìˆ˜ìš”ë¥¼ ì¦ëŒ€ì‹œì¼œ ì‹¤ì ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

5. â€œIs Apple Inc. (AAPL) Buying Back Its Stock in 2025? â€“ Yahoo Financeâ€  
   â€ƒ- ì¤‘ìš” ì´ìœ : ìì‚¬ì£¼ ë§¤ì… ê³„íšì€ ì£¼ì£¼ í™˜ì› ì •ì±…ì˜ ì¼í™˜ìœ¼ë¡œ, ì£¼ê°€ ë° íˆ¬ìì ì‹ ë¢°ì— ê¸ì •ì  ì˜í–¥ì„ ë¯¸ì³ ì¥ê¸°ì  ì‹¤ì  ê°œì„  ì „ë§ì— ê¸°ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

6. â€œApple will spend more than $500 billion in the U.S. over the next four years â€“ Apple Newsroomâ€  
   â€ƒ- ì¤‘ìš” ì´ìœ : ëŒ€ê·œëª¨ ë¯¸êµ­ íˆ¬ì ê³„íšì€ ìƒì‚° ë° R&D ì—­ëŸ‰ ê°•í™”ì— ë”°ë¥¸ ê¸°ìˆ  ê²½ìŸë ¥ í™•ë³´ì™€ ë¯¸ë˜ ì„±ì¥ ë™ë ¥ ì°½ì¶œì— ë„ì›€ì„ ì¤„ ê°€ëŠ¥ì„±ì´ ìˆì–´, ì¥ê¸°ì ì¸ ì‹¤ì  ì „ë§ì— í° ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.

ì´ì™€ ê°™ì€ ì œí’ˆ ì¶œì‹œ, íˆ¬ì ê³„íš, ì£¼ì£¼ í™˜ì› ì •ì±… ë“±ì€ ê°ê° í˜ì‹ ì„±, ì‹œì¥ ê²½ìŸë ¥, ì¬ë¬´ ê±´ì „ì„± ì¸¡ë©´ì—ì„œ Appleì˜ ë¯¸ë˜ ì‹¤ì ì— ìƒë‹¹í•œ ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.
```

- ë³´ê³ ì„œë¥¼ ê²€í† í•´ ê°œì„ í•  ì ì„ ì°¾ìŠµë‹ˆë‹¤.
  - ë¹„ìŠ·í•œ ì£¼ì œì˜ ë‰´ìŠ¤ë¥¼ ì—¬ëŸ¬ ë²ˆ ì„ ì •í•©ë‹ˆë‹¤.
  - ê° ë‰´ìŠ¤ê°€ ê¸°ì—…ì˜ ì‹¤ì  ì „ë§ì— ê¸ì •ì ì¸ì§€ ë¶€ì •ì ì¸ì§€ í•œ ëˆˆì— ì•Œì•„ë³¼ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.
  - LLMì˜ ì„±ëŠ¥ í•œê³„ë¡œ ë‰´ìŠ¤ ì œëª©ì´ ë³€í˜•ë˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.

### 4ï¸âƒ£ AI ë‰´ìŠ¤ ë¶„ì„ ì‹¬í™”: ê°ì„± ë¶„ì„ê³¼ êµ¬ì¡°í™”ëœ ì¶œë ¥

- ì‹¬í™”ëœ ë‰´ìŠ¤ ë¶„ì„ì„ ìœ„í•´ í”„ë¡¬í”„íŠ¸ë¥¼ ê°œì„ í•©ë‹ˆë‹¤.
  - ì¤‘ë³µë˜ëŠ” ì£¼ì œì˜ ê¸°ì‚¬ë¥¼ í”¼í•˜ë„ë¡ í•©ë‹ˆë‹¤.
  - ê°ì„± ë¶„ì„ì„ ë„ì…í•´, ë‰´ìŠ¤ ì†Œì‹ì´ ì‹¤ì ì— ë¯¸ì¹  ì˜í–¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.
  - ì¶œë ¥í•  JSON êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.
    - ê° í•„ë“œì— í•„ìš”í•œ ë‚´ìš©ì„ ì ì–´ì¤ë‹ˆë‹¤.
    - ìˆ˜ì¹˜ ê³„ì‚°ì´ í•„ìš”í•œ í•„ë“œì—ëŠ” ì˜ˆì‹œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

```python
# ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ ì‘ì„±í•˜ê¸°
prompt_news_dev_2 = f"""ë‹¤ìŒì€ {company_name}ì— ëŒ€í•œ ìµœê·¼ ë‰´ìŠ¤ ê¸°ì‚¬ì…ë‹ˆë‹¤.
ì œëª©ì„ ì‚´í´ë³´ê³  ê°ì„± ë¶„ì„ì„ í†µí•´ {company_name}ì˜ í–¥í›„ ì‹¤ì ì— ê¸ì •ì /ë¶€ì •ì  ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ë‰´ìŠ¤ ê¸°ì‚¬ë¥¼ 4ê±´ ì´ìƒ ì„ ì •í•˜ê³  ê·¸ ì´ìœ ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.
ê°™ì€ ì£¼ì œì˜ ê¸°ì‚¬ë¥¼ ì—¬ëŸ¬ ê°œ ê³¨ëë‹¤ë©´ ê·¸ ì¤‘ í•˜ë‚˜ë§Œ ì„ ì •í•´ *ì£¼ì„¸ìš”*. ì¶œì²˜ì˜ ì‹ ë¢°ì„±ê³¼ ì¤‘ë¦½ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„ ì •í•˜ë˜, ê¸ì •ì , ë¶€ì •ì  ì†Œì‹ì„ ê³¨ê³ ë£¨ ê²€í† í•´ ì£¼ì„¸ìš”.

ë¶„ì„ ê²°ê³¼ëŠ” ì£¼ì–´ì§„ JSON ìŠ¤í‚¤ë§ˆì— ë§ì¶°, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ í¬í•¨í•©ë‹ˆë‹¤.

'index' í•„ë“œì—ëŠ” ì£¼ì–´ì§„ ë‰´ìŠ¤ ë°ì´í„°ì—ì„œ í•´ë‹¹ ê¸°ì‚¬ì˜ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
'title' í•„ë“œì—ëŠ” ê¸°ì‚¬ì˜ ì œëª©ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ì›ë³¸ ì œëª©ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.
'reason' í•„ë“œì—ëŠ” íˆ¬ììì˜ ê´€ì ì—ì„œ í•´ë‹¹ ê¸°ì‚¬ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ì´ìœ ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.
'sentiment' í•„ë“œì—ëŠ” ê¸°ì‚¬ì˜ ê°ì„±ì„ 'ê¸ì •', 'ë¶€ì •', 'ì¤‘ë¦½'ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³ , ê°ê°ì— ì ì ˆí•œ emojiì™€ í•¨ê»˜ ë°˜í™˜í•©ë‹ˆë‹¤.
'overall_sentiment' í•„ë“œì—ëŠ” ëª¨ë“  ê¸°ì‚¬ì˜ ê°ì„±ì„ í‰ê· ë‚´ì–´ ì „ì²´ì ì¸ ê°ì„±ì„ ë°˜í™˜í•©ë‹ˆë‹¤. ê°ì„± ì ìˆ˜ëŠ” -5 (ë§¤ìš° ë¶€ì •ì : ëŒ€ë¶€ë¶„ì˜ ê¸°ì‚¬ê°€ ë¶€ì •ì )ì—ì„œ 5 (ë§¤ìš° ê¸ì •ì : ëŒ€ë¶€ë¶„ì˜ ê¸°ì‚¬ê°€ ê¸ì •ì ) ì‚¬ì´ì˜ ì •ìˆ˜ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ì´ 4ê±´ì˜ ê¸°ì‚¬ë¥¼ ì„ ì •í–ˆì„ ë•Œ ê¸°ì‚¬ 2ê±´ì„ 'ê¸ì •', 1ê±´ì„ 'ì¤‘ë¦½', ë‹¤ë¥¸ 1ê±´ì„ 'ë¶€ì •'ìœ¼ë¡œ ë¶„ë¥˜í–ˆë‹¤ê³  í•©ì‹œë‹¤. ì´ ë•Œ ì „ì²´ í‰ê°€ ì ìˆ˜ëŠ” (5 + 5 + 0 - 5) / 4 = 1.25, ë°˜ì˜¬ë¦¼í•˜ì—¬ 2ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
'sentiment_emoji' í•„ë“œì—ëŠ” ì „ì²´ì ì¸ ê°ì„±ì„ 'ğŸŸ¢', 'ğŸ”´', 'ğŸŸ¡'ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ê°ê°ì€ ê¸ì •, ë¶€ì •, ì¤‘ë¦½ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ëª¨ë“  ë‚´ìš©ì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”."""

prompt_news_user = f"""ë‰´ìŠ¤ ê¸°ì‚¬ ëª©ë¡(ë‚ ì§œ, ì œëª©, ì¶œì²˜, ë§í¬): {news_json}"""
```

- í”„ë¡¬í”„íŠ¸ì—ì„œ ì§€ì •í•œëŒ€ë¡œ JSON ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•˜ì—¬ êµ¬ì¡°í™”ëœ ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.

```python
# JSON ìŠ¤í‚¤ë§ˆ ì •ì˜í•˜ê¸°
news_format = {
    "type": "json_schema",
    "json_schema": {
        "name": "news_analysis",
        "schema": {
            "type": "object",
            "properties": {
                "articles": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "index": {"type": "integer"},
                            "title": {"type": "string"},
                            "reason": {"type": "string"},
                            "sentiment": {
                                "type": "string",
                            },
                        },
                        "required": [
                            "index", "title",
                            "reason", "sentiment"
                        ],
                        "additionalProperties": False,
                    },
                },
                "overall_sentiment": {
                    "type": "integer"
                },
                "sentiment_emoji": {
                    "type": "string",
                    "enum": ["ğŸŸ¢", "ğŸ”´", "ğŸŸ¡"],
                },
            },
            "required": [
                "articles",
                "overall_sentiment",
                "sentiment_emoji"
            ],
            "additionalProperties": False,
        },
    },
}
```

- êµ¬ì¡°í™”ëœ ì‘ë‹µì„ ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
  - ì „ì²´ ê°ì„± ë¶„ì„ ê²°ê³¼ë¥¼ ë„ì…ë¶€ì— ë°°ì¹˜í•©ë‹ˆë‹¤.
  - ì„ ì •ëœ ê¸°ì‚¬ì˜ ìš”ì•½ ì •ë³´ì™€ ì›ë¬¸ ë§í¬ë¥¼ í•¨ê»˜ ë³´ì—¬ì¤ë‹ˆë‹¤.

```python
# ì‘ë‹µ íŒŒì‹±í•˜ê¸°
analysis = json.loads(response.choices[0].message.content)
article_list = analysis['articles']
if not isinstance(article_list, list):
    article_list = [article_list]

# ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ ì‘ì„±í•˜ê¸°: ì¸íŠ¸ë¡œ ë¶€ë¶„
overall_sentiment = analysis["overall_sentiment"]
if overall_sentiment >= 0:
    overall_sentiment = f"+{overall_sentiment}"

report_md = f"# {company_name} ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤"
report_md += f"{len(article_list)}ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤.\n\n"
report_md += f"### ì „ì²´ ë‰´ìŠ¤ ê°ì„±: {overall_sentiment}"
report_md += f"{analysis['sentiment_emoji']}\n\n"
report_md += "---\n\n"

# ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ ì‘ì„±í•˜ê¸°: ë³¸ë¬¸ ë¶€ë¶„
for article in article_list:
    article_title = article['title']
# ì œëª©ìœ¼ë¡œ ì›ë³¸ ë§í¬ ì°¾ê¸°
    match = news_df[news_df['title'] == article_title]

    article_link = "#"
    if not match.empty:
        article_link = match['link'].values[0]
    else:
# ì¼ì¹˜í•˜ëŠ” ì œëª© ì—†ì„ ê²½ìš° ê²€ìƒ‰ìœ¼ë¡œ ì°¾ê¸°
        encoded_title = urllib.parse.quote(article_title)
        url = f"<https://news.google.com/rss/search?q={encoded_title}&hl=en-US&gl=US&ceid=US:en>" if market == "ovs" else f"<https://news.google.com/rss/search?q={encoded_title}&hl=ko&gl=KR&ceid=KR:ko>"
        response = requests.get(url)
        feed = feedparser.parse(response.text)

        if feed.entries:
            article_link = feed.entries[0].link

# ë³´ê³ ì„œì— ì¶”ê°€í•˜ê¸°
    report_md += f"### [{article_title}]({article_link})\n"
    report_md += f"**ê°ì„±**: {article['sentiment']}\n\n"
    report_md += f"**ì„ ì • ì´ìœ **: {article['reason']}\n\n"
    report_md += "---\n\n"

# ê²°ê³¼ ì €ì¥í•˜ê¸°
with open(report_path / f"{stock_code}_v2.md", "w",
          encoding="utf-8") as file:
    file.write(report_md)

```

- ìƒì„± ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

```
# Apple Inc. ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤ 4ê°œë¥¼ ì„ ì •í–ˆìŠµë‹ˆë‹¤.

### ì „ì²´ ë‰´ìŠ¤ ê°ì„±: +0 ğŸŸ¡

---

### [Apple debuts iPhone 16e: A powerful new member of the iPhone 16 family - Apple Newsroom](<https://news.google.com/>...)
**ê°ì„±**: ê¸ì • ğŸŸ¢

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” ìƒˆë¡œìš´ iPhone ëª¨ë¸ì„ ë°œí‘œí•¨ìœ¼ë¡œì¨ Appleì˜ ì œí’ˆ ë¼ì¸ì—…ì´ ê°•í™”ë˜ê³  ì†Œë¹„ìë“¤ì˜ ê´€ì‹¬ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¬ ê°€ëŠ¥ì„±ì´ ìˆì–´ í–¥í›„ ì‹¤ì ì— ê¸ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.

---

### [Apple will spend more than $500 billion in the U.S. over the next four years - Apple Newsroom](<https://news.google.com/>...)
**ê°ì„±**: ê¸ì • ğŸŸ¢

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” ë¯¸êµ­ ë‚´ì—ì„œ ëŒ€ê·œëª¨ íˆ¬ìë¥¼ ì§„í–‰í•œë‹¤ëŠ” ì†Œì‹ìœ¼ë¡œ, Appleì˜ ì„±ì¥ ì „ëµê³¼ ì‹œì¥ í™•ëŒ€ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ì˜ì§€ë¥¼ ë³´ì—¬ì£¼ì–´ íˆ¬ììë“¤ì—ê²Œ ê¸ì •ì ì¸ ì‹ í˜¸ë¡œ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### [Apple Delays Siri Upgrade Indefinitely as AI Concerns Escalate - Bloomberg](<https://news.google.com/>...)
**ê°ì„±**: ë¶€ì • ğŸ”´

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” Siriì˜ AI ì—…ê·¸ë ˆì´ë“œê°€ ë¬´ê¸°í•œ ì—°ê¸°ëœë‹¤ëŠ” ì†Œì‹ìœ¼ë¡œ, Appleì˜ ì¸ê³µì§€ëŠ¥ ê²½ìŸë ¥ ê°•í™”ì— ì°¨ì§ˆì´ ìˆì„ ìˆ˜ ìˆìŒì„ ì‹œì‚¬í•˜ì—¬ ë‹¨ê¸°ì ìœ¼ë¡œ ë¶€ì •ì ì¸ ì˜í–¥ì„ ë¯¸ì¹  ìš°ë ¤ê°€ ìˆìŠµë‹ˆë‹¤.

---

### [Apple Crippled By AI Failure - 24/7 Wall St.](<https://news.google.com/>...)
**ê°ì„±**: ë¶€ì • ğŸ”´

**ì„ ì • ì´ìœ **: ì´ ê¸°ì‚¬ëŠ” Appleì´ ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì—ì„œ ì‹¤íŒ¨ë¥¼ ê²ªê³  ìˆë‹¤ëŠ” ë‚´ìš©ì„ ë‹¤ë£¨ê³  ìˆìœ¼ë©°, ê¸°ìˆ  í˜ì‹ ì— ì‹¤íŒ¨í•  ê²½ìš° íˆ¬ì ì‹¬ë¦¬ì— ë¶€ì •ì ì¸ ì˜í–¥ì„ ë¼ì¹  ìˆ˜ ìˆì–´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

---

```

<aside>
â•

**í…ìŠ¤íŠ¸ ê°ì„± ë¶„ì„(Sentiment Analysis)**

- ê°ì„± ë¶„ì„ì€ í…ìŠ¤íŠ¸ì—ì„œ ê°ì •, ì˜ê²¬, íƒœë„ë¥¼ ì¶”ì¶œí•˜ëŠ” ìì—°ì–´ ì²˜ë¦¬ ê¸°ë²•ì…ë‹ˆë‹¤.
- ì£¼ì‹ ì‹œì¥ì—ì„œëŠ” ë‰´ìŠ¤ì˜ ê°ì„±(ê¸ì •/ë¶€ì •/ì¤‘ë¦½)ì´ ì£¼ê°€ ì›€ì§ì„ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤. - íˆ¬ììë“¤ì€ ê°ì„± ë¶„ì„ì„ í†µí•´ ì‹œì¥ ë¶„ìœ„ê¸°ë¥¼ íŒŒì•…í•˜ê³  íˆ¬ì ê²°ì •ì— ì°¸ê³ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</aside>
