안녕하세요, 여러분! 오늘은 지난 시간에 배웠던 기본적 분석을 한 단계 더 발전시켜보는 시간을 가져볼게요.

이전 강의에서는 재무제표 데이터를 가져와서 AI에게 분석을 요청하는 기본적인 방법을 배웠죠. 오늘은 여기에 몇 가지 중요한 재무 지표들을 추가하고, 프롬프트도 더 정교하게 만들어서 더 풍부하고 유용한 분석 보고서를 만들어 보겠습니다.

## 1. 추가 재무지표의 의미와 활용

투자자들이 기업을 분석할 때는 재무제표 원본 데이터만 보는 것이 아니라, 이를 가공한 여러 지표들을 함께 살펴봅니다. 특히 다음의 지표들은 주식 투자에서 매우 중요하게 여겨져요.

- 첫 번째는 EPS(이피에스),(Earnings Per Share) ‘주당순이익’입니다. 기업의 순이익을 발행주식수로 나눈 값으로, 한 주당 얼마의 이익을 창출했는지 보여줍니다.
- 두 번째는 BPS(비피에스)(Book-value Per Share), ‘주당순자산’입니다. 기업의 순자산을 발행주식수로 나눈 값으로, 주당 보유한 자산가치를 의미합니다.
- 세 번째는 PER(피이알)(Price to Earnings Ratio), ‘주가수익비율’입니다. 주가를 주당 순이익(EPS)으로 나눈 값으로, 기업의 수익 대비 주가가 얼마나 비싼지 보여줍니다.
- 네 번째는 PBR(피비알)(Price to Book Ratio), ‘주가순자산비율’입니다. 주가를 주당 순자산(BPS)으로 나눈 값으로, 기업의 장부가치 대비 주가가 얼마나 비싼지 보여줍니다.

이런 지표들의 특징은 계산에 재무정보와 더불어 현재 주가가 반영된다는 점입니다. 예를 들어 PBR은 가장 최근에 발표된 재무제표의 BPS와 현재 주가로 계산됩니다. 이런 지표들은 대부분 증권사 API를 통해 바로 받아올 수 있는데요, 증권사 API를 사용하면 계산을 직접 할 필요 없이 바로 최신 값을 받아올 수 있어서 편리합니다. 우리는 이미 4강에서 배웠던 한국투자증권 API를 활용해서 이 데이터들을 가져와 보겠습니다.

## 2. 데이터 가져오기

먼저 필요한 라이브러리들을 임포트하고 환경을 설정해줍니다. ~~이 부분은 지난 시간과 거의 동일하니 간략하게 넘어가겠습니다~~. 추가 지표를 가져오기 위한 한국투자증권 API 키 설정~~과 관련 라이브러리~~만 추가되었습니다.

```python
import json
import os
import pandas as pd
import time
import requests

from datetime import datetime
from sec_cik_mapper import StockMapper
from dotenv import load_dotenv
from openai import OpenAI
from pathlib import Path
```

```python
load_dotenv()

OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
USER_AGENT = os.getenv("USER_AGENT")

# KIS API 키 설정
KIS_URL_BASE = os.getenv("KIS_URL_BASE")
KIS_ACCESS_TOKEN = os.getenv("KIS_ACCESS_TOKEN")
KIS_APP_KEY = os.getenv("KIS_APP_KEY")
KIS_APP_SECRET = os.getenv("KIS_APP_SECRET")

openai_client = OpenAI(api_key=OPENAI_API_KEY)
```

```python
# 조회할 종목 지정
market = "ovs"  # 해외주식
stock_code = "AAPL"  # Apple Inc.

# 파일 경로 지정
root_path = Path(__vsc_ipynb_file__).parent
data_path = root_path / "data"
report_path = root_path / "report"

# 경로 생성
data_path.mkdir(parents=True, exist_ok=True)
report_path.mkdir(parents=True, exist_ok=True)
```

```python
# 데이터 가져오기: 재무제표 (8강과 동일)
df_fin = pd.read_csv(data_path / f"{stock_code}.csv")
```

```python
path = "/uapi/overseas-price/v1/quotations/price-detail"
url = f"{KIS_URL_BASE}/{path}"

# API 요청 헤더 설정 (인증 정보 포함)
headers = {
    "content-type": "application/json; charset=utf-8",
    "authorization": f"Bearer {KIS_ACCESS_TOKEN}",
    "appkey": KIS_APP_KEY,
    "appsecret": KIS_APP_SECRET,
    "tr_id": "HHDFS76200200",
    "custtype": "P",
}

params = {
    "AUTH": "",
    "EXCD": "NAS",  # 나스닥 상장사 기준
    "SYMB": stock_code
}

time.sleep(0.1)  # API 호출 제한 방지를 위한 지연
response = requests.get(url, headers=headers, params=params)
data = response.json()
```

여기서는 증권사 API 중에서도 ‘해외주식 현재가상세’ API를 통해 현재 주가가 반영된 재무지표들을 불러오겠습니다.

접근 토큰 발급, API 접근에 관해서는 지난 3, 4강의 내용을 참고해주세요.

기존에 발급해둔 액세스 토큰이 있다면 불러오고, 24시간이 지나 만료되었다면 새로 발급하면 됩니다.

분석할 종목을 지정하고, API 문서에서 요구하는 스펙에 맞게 호출하면, 다음과 같이 원하는 데이터가 조회된 것을 확인할 수 있습니다!

```json
{'output': {'rsym': 'DNASAAPL',
  'zdiv': '4',
  'curr': 'USD',
  'vnit': '1',
  'open': '235.5400',
  'high': '236.1600',
  'low': '224.2200',
  'last': '227.4800',
  'base': '239.0700',
  'pvol': '46273565',
  'pamt': '11054685388',
  'uplp': '0.0000',
  'dnlp': '0.0000',
  'h52p': '259.8144',
  'h52d': '20241226',
  'l52p': '163.3041',
  'l52d': '20240419',
  'perx': '36.16',
  'pbrx': '51.25',
  'epsx': '6.29',
  'bpsx': '4.44',
  'shar': '15022100000',
  'mcap': '84768000000',
  'tomv': '3417227308000',
  't_xprc': '331143',
...
  'tamt': '16406852942',
  'etyp_nm': ''},
 'rt_cd': '0',
 'msg_cd': 'MCA00000',
 'msg1': '정상처리 되었습니다.'}
```

전일 주가 정보와 함께 주요 재무지표인 PER, PBR, EPS, BPS 등의 정보가 들어있습니다. 이 재무지표만 따로 재무데이터 폴더에 csv 파일로 저장해 보겠습니다.

```python
# 산출 시점 기록
df_idx = pd.DataFrame(
    data["output"], index=[
            datetime.now().strftime("%Y-%m-%d")
        ]
)

# 주요재무지표 열만 추출, 이름 수정
df_idx = df_idx[["perx", "pbrx", "epsx", "bpsx"]]
df_idx.columns = ["PER", "PBR", "EPS", "BPS"]

# 파일 저장
df_idx.to_csv(data_path / f"{stock_code}_idx.csv",
                index=True)
```

## 3. 개선된 프롬프트로 AI에게 분석 요청하기

이제 AI에게 더 정교한 분석을 요청해 볼 차례입니다. 이전 강의보다 더 구체적인 가이드라인과 함께 분석을 요청해 보겠습니다.

종목 코드를 기업명으로 변환하기 위해 `StockMapper` (스탁 매퍼) 모듈을 활용하겠습니다.

```python
# 기업명 조회 -> 프롬프트에서 사용
stock_mapper = StockMapper()
company_name = stock_mapper.ticker_to_company_name[stock_code]
```

```python
# 프롬프트
prompt_dev = f"""
너는 투자 분석가야. 다음 기업 {company_name}의 연간 사업보고서와 최신 주가를 반영한 주요 재무 지표를 참고하여 이 기업의 재무 상태를 요약, 분석한 Markdown 형식의 보고서를 한국어로 출력해줘.
영어로 된 항목 이름은 한국어로 번역해서 표시해줘.
직접적인 투자 의견을 제시하는 것은 피하고, 기업의 최근 재무 상태 분석에 초점을 맞춰줘.
분석 결과는 투자 초보자도 이해할 수 있는 수준으로 쉽고 자세하게 설명하고, 그 근거로 재무제표 상의 구체적인 수치를 포함해줘.

보고서는 주어진 JSON 구조에 맞추고, 다음 섹션들을 포함해 작성해줘.
<report_headers>
종합 요약:
주요 재무 지표 분석:
사업보고서 분석
    - 손익계산서, 재무 건전성, 현금 흐름의 측면에서 다양하게 분석할 것.
결론 및 투자 시사점:
</report_headers>
"""

prompt_user = f"""
최근 연간 사업보고서: {df_fin.to_json(indent=4, force_ascii=False)}

주요 재무 지표: {df_idx.to_json(indent=4, force_ascii=False)}
"""
```

기술적 분석에서 했던 것처럼 더 구체적인 프롬프트를 작성했어요.

먼저 원본 재무제표의 항목이 모두 영어이다보니 한국어 보고서에는 번역해서 표기하도록 했습니다.

또 보고서에 반영할 분석의 관점을 손익계산서, 재무 건전성, 현금 흐름, 크게 세 가지로 구분했고,

사용자 프롬프트에는 연간 재무제표와 함께 추가로 가져온 지표 데이터를 포함했습니다.

## 4. 출력 형식 지정하기

여기서도 JSON 스키마로 응답 형식을 지정해 주겠습니다. 구조는 7강에서 지정한 형식과 거의 동일합니다.

```python
# 기본 분석 보고서 출력 형식 지정:
fund_response_format = {"type": "json_schema", "json_schema": {
    "name": "fundamental_report",
    "schema": {
        "type": "object",
        "properties": {
            "intro": {"type": "string"},
            "financial_report": {"type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                        "heading": {"type": "string"},
                        "content": {"type": "string"}
                },
                "required": ["heading", "content"],
                "additionalProperties": False
                },
            },
        },
        "required": ["intro", "financial_report"],
        "additionalProperties": False
        }
    }
}
```

## 5. OpenAI API 호출하기

이 프롬프트와 형식으로 OpenAI API를 호출하고 응답을 받아보겠습니다.

```python
# OpenAI API 호출: 개발자 프롬프트 변경, response_format 추가
reasoning_effort = "medium"
response = openai_client.chat.completions.create(
    model="o3-mini",
    messages=[
        {"role": "developer", "content": prompt_dev},
        {"role": "user", "content": prompt_user}
    ],
    reasoning_effort=reasoning_effort,
    response_format=fund_response_format
)
```

## 6. 보고서 포매팅 및 저장

마지막으로, 받은 응답을 원하는 형태의 마크다운 파일로 변환하고 저장합니다.

```python
# 보고서 포매팅 및 저장
raw_response = json.loads(response.choices[0].message.content)

report_md = ""
report_md += f"{raw_response['intro']}\n\n"
report_md += f"---\n\n"
for section in raw_response['financial_report']:
    report_md += f"## {section['heading']}\n\n"
    report_md += f"{section['content']}\n\n"

with open(report_path / f"{stock_code}_v2.md", "w") as f:
    f.write(report_md)
```

최종적으로 이렇게 만들어진 보고서를 파일로 저장합니다.

```markdown
Apple Inc. 기업은 세계적인 기술 리더로서 안정적인 재무 구조와 뛰어난 영업 성과를 보여주고 있습니다. 최근 연간 사업보고서와 최신 재무 지표를 종합해 보면, 견고한 자산 기반과 강력한 현금 창출 능력을 바탕으로 수익성을 유지하며 재무 건전성을 확보하고 있음을 알 수 있습니다.

---

## 종합 요약

Apple은 2024년 기준 총 자산 약 3650억 달러, 총 부채 약 3080억 달러, 자본은 수십억 달러 규모로 안정된 재무 구조를 갖추고 있습니다. 매출은 약 3943억 달러 수준으로, 세계적인 브랜드 가치와 제품 경쟁력을 토대로 견고한 매출 기반을 유지하고 있습니다. 또한, 영업 및 순이익 측면에서도 꾸준한 성과를 보여주어 전체적인 재무 상태가 양호함을 확인할 수 있습니다.

## 주요 재무 지표 분석

최신 재무 지표를 보면, PER(주가수익비율)은 37.48, PBR(주가순자산비율)은 53.11로 나타납니다. 이는 시장이 Apple의 미래 성장과 무형 자산, 브랜드 가치를 높게 평가하고 있음을 의미합니다. 또한, EPS(주당순이익)는 6.29, BPS(주당순자산)는 4.44로 기록되어 전반적인 수익성과 재무 건전성이 양호함을 시사합니다. 단, 상대적으로 높은 PBR은 주가가 장부가치보다 크게 평가되고 있음을 보여주므로, 기업의 무형 자산 및 미래 기대치가 크게 반영된 결과로 해석할 수 있습니다.

## 사업보고서 분석

1. 손익계산서 측면:

- Apple은 계약 기반 매출(Revenue From Contract With Customer)이 약 3943억 달러 수준으로 견실한 매출을 기록하고 있습니다.
- 매출원가(Cost Of Goods And Services Sold)는 약 2235억 달러로, 효율적인 원가 관리가 돋보이며, 이로 인해 순이익(Net Income)은 약 998억 달러에 달해 우수한 수익 창출 능력을 보여줍니다.

2. 재무 건전성 측면:

- 총 자산은 약 3650억 달러, 부채는 약 3080억 달러 수준으로 나타나며, 자본 구조는 안정적입니다.
- 현금 및 현금등가물(Cash And Cash Equivalents)은 약 299억 달러로 단기 유동성 측면에서 우수한 상태를 유지하고 있습니다.

3. 현금 흐름 측면:

- 영업활동으로부터의 현금 흐름(Net Cash Provided By Used In Operating Activities)은 약 1221억 달러로, 강력한 현금 창출 능력을 보여줍니다.
- 투자활동(Net Cash Provided By Used In Investing Activities)에서는 소폭의 현금 유출이 있었고, 재무활동(Net Cash Provided By Used In Financing Activities)에서는 자사주 매입 및 부채 상환 등으로 인해 현금 유출이 발생하여, 기업이 내부 자금을 효과적으로 재투자하거나 주주 환원 정책을 시행하고 있음을 시사합니다.

## 결론 및 투자 시사점

Apple은 건실한 매출 기반과 강력한 현금 흐름, 안정적인 재무 구조를 통해 꾸준한 수익성을 유지하고 있습니다. 시장에서는 높은 PER과 PBR로 미래 성장 기대감과 무형 자산의 가치를 반영하고 있으나, 이러한 높은 평가는 투자자들에게 리스크 검토가 필요함을 암시합니다. 전반적으로 기업의 재무 상태는 견실하나, 재무 비율에 대한 면밀한 분석 후 투자 결정을 내리는 것이 바람직합니다.
```

## 결과 살펴보기

결과를 확인해볼까요?

오, 확실히 더 체계적이고 상세한 분석을 해주네요.

예를 들어, 보고서의 각 섹션은 다음과 같은 내용을 포함하고 있습니다.

1. 먼저 기업의 전체적인 재무 상태를 요약하면서 시작하고요,
2. PER, PBR 등 주요 지표의 의미를 분석합니다.
3. 다음으로 손익계산서, 재무 건전성, 현금 흐름 측면에서 사업보고서를 세부적으로 분석하고,
4. 전체 분석을 바탕으로 한 투자 시사점을 제시하는 걸 볼 수 있습니다.

보통 재무제표와 관련 지표들은 중요하다고 하긴 하지만, 읽고 이해하기 매우 어려운 게 사실이죠.

하지만 이렇게 AI의 도움을 받으면 훨씬 수월하게 중요한 내용들만 골라 이해할 수 있어서 아주 좋답니다!

## 마무리

오늘은 재무 지표를 추가하고 프롬프트를 개선하여 더 고도화된 기본적 분석 보고서를 만들어 보았습니다. 이러한 접근 방식을 활용하면 보다 종합적이고 깊이 있는 기업 분석이 가능해집니다.

여러분도 직접 다양한 기업에 이 코드를 적용해보고, 프롬프트를 더 발전시켜 보세요. 예를 들어, 동종 업계 기업들과의 비교 분석이나, 여러 해에 걸친 추세 분석 등을 추가하면 더욱 유용한 분석 도구가 될 수 있을 거예요.

다음 시간에는 뉴스 데이터를 가져와서 AI에게 분석시키는 방법을 배워보도록 하겠습니다. 감사합니다!

---

### 1️⃣ 주요 재무지표의 의미와 활용

- 재무지표는 기업의 재무제표 데이터를 가공한 값으로, 투자 판단에 중요한 정보를 제공합니다.
    - 주당순이익(EPS)은 기업의 순이익을 발행주식수로 나눈 값으로, 주당 창출한 이익을 나타냅니다.
    - 주당순자산(BPS)은 기업의 순자산을 발행주식수로 나눈 값으로, 주당 보유한 자산가치를 의미합니다.
    - 주가수익비율(PER)은 주가를 EPS로 나눈 값으로, 수익 대비 주가가 얼마나 비싼지 보여줍니다.
    - 주가순자산비율(PBR)은 주가를 BPS로 나눈 값으로, 장부가치 대비 주가가 얼마나 비싼지 나타냅니다.
- 이런 지표들은 현재 주가가 반영된다는 특징이 있어 증권사 API를 통해 최신 값을 받아오면 편리합니다.

<aside>
➕

**재무지표 계산 예시**

- 순이익 1억 원, 순자산 5억 원, 발행주식 1만 주, 주가가 7만원인 기업의 재무지표를 계산해봅시다.
    - EPS = (순이익) ÷ (발행주식 수) = 1만 원
    - BPS = (순자산) ÷ (발행주식 수) = 5만 원
    - PER = (주가) ÷ EPS = 7
    - PBR = (주가) ÷ BPS = 1.4
</aside>

### 2️⃣ 재무지표 수집하기

- 한국투자증권 API를 활용해 추가 재무지표를 가져옵니다.
    - 해외 기업의 재무지표는 ‘해외주식 현재가상세’ API에서 얻을 수 있습니다.

```python
# API 요청 경로 설정하기
path = "/uapi/overseas-price/v1/quotations/price-detail"
url = f"{KIS_URL_BASE}/{path}"

# API 요청 헤더 설정하기 (인증 정보 포함)
headers = {
    "content-type": "application/json; charset=utf-8",
    "authorization": f"Bearer {KIS_ACCESS_TOKEN}",
    "appkey": KIS_APP_KEY,
    "appsecret": KIS_APP_SECRET,
    "tr_id": "HHDFS76200200",
    "custtype": "P",
}

# 요청 파라미터 설정하기
params = {
    "AUTH": "",
    "EXCD": "NAS",  # 나스닥 상장사 기준
    "SYMB": stock_code
}

# API 호출하기
time.sleep(0.1)  # API 호출 제한 방지를 위한 지연
response = requests.get(url, headers=headers, params=params)
data = response.json()

```

<aside>
⚠️

**여기서 잠깐!**

- API 호출에는 일정 시간 간격을 두어야 합니다.
    - 대부분의 API는 초당/일간 호출 제한이 있어 `time.sleep()`으로 지연을 주는 것이 좋습니다.
        - 한국투자 API의 경우 1초당 20건으로 제한을 두고 있습니다.
        - SEC EDGAR의 경우 1초당 10건으로 제한하고 있습니다.
    - 제한을 초과하면 일시적으로 API 접근이 차단될 수 있습니다.
</aside>

- 조회 결과를 확인합니다.

```json
{'output': {'rsym': 'DNASAAPL',
  'zdiv': '4',
  'curr': 'USD',
  'vnit': '1',
...
  'perx': '36.16',
  'pbrx': '51.25',
  'epsx': '6.29',
  'bpsx': '4.44',
...
  'tamt': '16406852942',
  'etyp_nm': ''},
 'rt_cd': '0',
 'msg_cd': 'MCA00000',
 'msg1': '정상처리 되었습니다.'}
```

- API 응답에서 원하는 재무지표만 추출하여 저장합니다.

```python
# 산출 시점 기록하기
df_idx = pd.DataFrame(
    data["output"], index=[datetime.now().strftime("%Y-%m-%d")])

# 주요재무지표 열만 추출하고 이름 수정하기
df_idx = df_idx[["perx", "pbrx", "epsx", "bpsx"]]
df_idx.columns = ["PER", "PBR", "EPS", "BPS"]

# 파일로 저장하기
df_idx.to_csv(data_path / f"{stock_code}_idx.csv", index=True)
```

<aside>
➕

**재무지표의 산업별 해석**

- 재무지표는 산업 특성, 기업 규모, 성장 단계에 따라 다르게 해석해야 합니다.
    - PER(주가수익비율)은 산업과 성장 단계에 따라 적정 수준이 다릅니다.
        - 성장 산업 기업: 비교적 높은 PER
        - 성숙 산업 기업: 비교적 낮은 PER
    - PBR(주가순자산비율)도 산업별로 차이가 있습니다.
        - 제조업: 유형자산이 많아 PBR이 낮은 경향
        - IT/서비스업: 무형자산 비중이 높아 PBR이 높은 경향
- 재무지표 해석 시 한 가지 지표에만 의존하기보다 여러 지표를 종합적으로 분석해야 합니다.
    - 재무지표는 단일 수치보다 시계열 추세와 동종 업계 비교를 통해 더 의미 있는 분석이 가능합니다.
</aside>

### 3️⃣ 고도화된 프롬프트 작성하기

- 더 구체적인 가이드라인을 포함한 프롬프트를 작성합니다.
    - 영문 재무제표의 항목을 한국어로 번역해서 표시하도록 합니다.
    - 분석의 관점은 손익계산서, 재무 건전성, 현금 흐름의 측면으로 구분해, JSON 형식으로 작성하도록 합니다.
    - 사용자 프롬프트에 지표 데이터를 추가합니다.

```python
# 기업명 조회하기 -> 프롬프트에서 사용
stock_mapper = StockMapper()
company_name = stock_mapper.ticker_to_company_name[stock_code]

# 개발자 프롬프트 작성하기
prompt_dev = f"""
너는 투자 분석가야. 다음 기업 {company_name}의 연간 사업보고서와 최신 주가를 반영한 주요 재무 지표를 참고하여 이 기업의 재무 상태를 요약, 분석한 Markdown 형식의 보고서를 한국어로 출력해줘.
영어로 된 항목 이름은 한국어로 번역해서 표시해줘.
직접적인 투자 의견을 제시하는 것은 피하고, 기업의 최근 재무 상태 분석에 초점을 맞춰줘.
분석 결과는 투자 초보자도 이해할 수 있는 수준으로 쉽고 자세하게 설명하고, 그 근거로 재무제표 상의 구체적인 수치를 포함해줘.

보고서는 주어진 JSON 구조에 맞추고, 다음 섹션들을 포함해 작성해줘.
<report_headers>
종합 요약:
주요 재무 지표 분석:
사업보고서 분석
    - 손익계산서, 재무 건전성, 현금 흐름의 측면에서 다양하게 분석할 것.
결론 및 투자 시사점:
</report_headers>
"""

# 사용자 프롬프트 작성하기
prompt_user = f"""
최근 연간 사업보고서: {df_fin.to_json(indent=4, force_ascii=False)}

주요 재무 지표: {df_idx.to_json(indent=4, force_ascii=False)}
"""

```

### 4️⃣ 응답 형식 지정 및 보고서 생성하기

- JSON 스키마를 통해 일관된 응답 형식을 지정합니다.

```python
# 기본 분석 보고서 출력 형식 지정하기
fund_response_format = {"type": "json_schema", "json_schema": {
    "name": "fundamental_report",
    "schema": {
        "type": "object",
        "properties": {
            "intro": {"type": "string"},
            "financial_report": {"type": "array",
                "items": {
                    "type": "object",
                    "properties": {
                        "heading": {"type": "string"},
                        "content": {"type": "string"}
                },
                "required": ["heading", "content"],
                "additionalProperties": False
                },
            },
        },
        "required": ["intro", "financial_report"],
        "additionalProperties": False
        }
    }
}
```

- OpenAI API를 호출하여 분석 보고서를 생성합니다.

```python
# OpenAI API 호출하기
reasoning_effort = "medium"
response = openai_client.chat.completions.create(
    model="o3-mini",
    messages=[
        {"role": "developer", "content": prompt_dev},
        {"role": "user", "content": prompt_user}
    ],
    reasoning_effort=reasoning_effort,
    response_format=fund_response_format
)
```

- API 응답을 마크다운 형식으로 변환하여 저장합니다.

```python
# 보고서 포맷팅 및 저장하기
raw_response = json.loads(response.choices[0].message.content)

report_md = ""
report_md += f"{raw_response['intro']}\\n\\n"
report_md += f"---\\n\\n"
for section in raw_response['financial_report']:
    report_md += f"## {section['heading']}\\n\\n"
    report_md += f"{section['content']}\\n\\n"

with open(report_path / f"{stock_code}_v2.md", "w") as f:
    f.write(report_md)

```

- 생성 결과를 확인합니다.

```markdown
Apple Inc. 기업은 세계적인 기술 리더로서 안정적인 재무 구조와 뛰어난 영업 성과를 보여주고 있습니다. 최근 연간 사업보고서와 최신 재무 지표를 종합해 보면, 견고한 자산 기반과 강력한 현금 창출 능력을 바탕으로 수익성을 유지하며 재무 건전성을 확보하고 있음을 알 수 있습니다.

---

## 종합 요약

Apple은 2024년 기준 총 자산 약 3650억 달러, 총 부채 약 3080억 달러, 자본은 수십억 달러 규모로 안정된 재무 구조를 갖추고 있습니다. 매출은 약 3943억 달러 수준으로, 세계적인 브랜드 가치와 제품 경쟁력을 토대로 견고한 매출 기반을 유지하고 있습니다. 또한, 영업 및 순이익 측면에서도 꾸준한 성과를 보여주어 전체적인 재무 상태가 양호함을 확인할 수 있습니다.

## 주요 재무 지표 분석

최신 재무 지표를 보면, PER(주가수익비율)은 37.48, PBR(주가순자산비율)은 53.11로 나타납니다. 이는 시장이 Apple의 미래 성장과 무형 자산, 브랜드 가치를 높게 평가하고 있음을 의미합니다. 또한, EPS(주당순이익)는 6.29, BPS(주당순자산)는 4.44로 기록되어 전반적인 수익성과 재무 건전성이 양호함을 시사합니다. 단, 상대적으로 높은 PBR은 주가가 장부가치보다 크게 평가되고 있음을 보여주므로, 기업의 무형 자산 및 미래 기대치가 크게 반영된 결과로 해석할 수 있습니다.

## 사업보고서 분석

1) 손익계산서 측면:
- Apple은 계약 기반 매출(Revenue From Contract With Customer)이 약 3943억 달러 수준으로 견실한 매출을 기록하고 있습니다.
- 매출원가(Cost Of Goods And Services Sold)는 약 2235억 달러로, 효율적인 원가 관리가 돋보이며, 이로 인해 순이익(Net Income)은 약 998억 달러에 달해 우수한 수익 창출 능력을 보여줍니다.

2) 재무 건전성 측면:
- 총 자산은 약 3650억 달러, 부채는 약 3080억 달러 수준으로 나타나며, 자본 구조는 안정적입니다.
- 현금 및 현금등가물(Cash And Cash Equivalents)은 약 299억 달러로 단기 유동성 측면에서 우수한 상태를 유지하고 있습니다.

3) 현금 흐름 측면:
- 영업활동으로부터의 현금 흐름(Net Cash Provided By Used In Operating Activities)은 약 1221억 달러로, 강력한 현금 창출 능력을 보여줍니다.
- 투자활동(Net Cash Provided By Used In Investing Activities)에서는 소폭의 현금 유출이 있었고, 재무활동(Net Cash Provided By Used In Financing Activities)에서는 자사주 매입 및 부채 상환 등으로 인해 현금 유출이 발생하여, 기업이 내부 자금을 효과적으로 재투자하거나 주주 환원 정책을 시행하고 있음을 시사합니다.

## 결론 및 투자 시사점

Apple은 건실한 매출 기반과 강력한 현금 흐름, 안정적인 재무 구조를 통해 꾸준한 수익성을 유지하고 있습니다. 시장에서는 높은 PER과 PBR로 미래 성장 기대감과 무형 자산의 가치를 반영하고 있으나, 이러한 높은 평가는 투자자들에게 리스크 검토가 필요함을 암시합니다. 전반적으로 기업의 재무 상태는 견실하나, 재무 비율에 대한 면밀한 분석 후 투자 결정을 내리는 것이 바람직합니다.
```