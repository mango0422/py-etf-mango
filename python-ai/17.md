ì•ˆë…•í•˜ì„¸ìš”, ì—¬ëŸ¬ë¶„! ë“œë””ì–´ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ë§ˆì§€ë§‰ ë‹¨ê³„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ KIS í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” íŒ¨í‚¤ì§€, ë°ì´í„° ê´€ë¦¬ íŒ¨í‚¤ì§€ì™€ ë¶„ì„ ê¸°ëŠ¥ íŒ¨í‚¤ì§€ë¥¼ êµ¬í˜„í–ˆëŠ”ë°ìš”,

ì˜¤ëŠ˜ì€ ì´ ëª¨ë“  ê²ƒë“¤ì„ ì¢…í•©í•´ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì¶•í•´ë³´ê² ìŠµë‹ˆë‹¤.

## 1. ëŒ€ì‹œë³´ë“œ ê°œìš” ë° ë ˆì´ì•„ì›ƒ ì„¤ì •

ë¨¼ì € ìš°ë¦¬ê°€ ë§Œë“¤ ëŒ€ì‹œë³´ë“œì˜ ì „ì²´ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ì´ì „ì— êµ¬ìƒí–ˆë˜ ë ˆì´ì•„ì›ƒì„ ê¸°ì–µí•˜ì‹œë‚˜ìš”?

![image.png](attachment:194345f5-fe28-4ec0-841b-470c8315f860:3aecc431-734c-49b3-a8e9-734feb40cfbe.png)

ì´ ë ˆì´ì•„ì›ƒì— ë§ì¶° ì‹¤ì œ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³¼ ê±°ì˜ˆìš”.

ì „ì²´ ë ˆì´ì•„ì›ƒ êµ¬ìƒí•  ë•Œ ì„¤ì •í•œ 5ê°œ ì˜ì—­ì„ í‘œì‹œí•´ì•¼ í•˜ëŠ”ë°ìš”,

êµ¬í˜„ ê´€ì ì—ì„œëŠ” í¬ê²Œ ì„¸ ê°€ì§€ ì£¼ìš” ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **ìƒë‹¨ì˜ ì»¨íŠ¸ë¡¤ ì˜ì—­ì—ì„œ** ì‚¬ìš©ì ì…ë ¥ì„ ì²˜ë¦¬í•˜ê³ ,
2. **í•˜ë‹¨ ì½˜í…ì¸  ì˜ì—­ì„ ì¢Œìš°ë¡œ ë¶„ë¦¬í•´ì„œ - ì™¼ìª½:**ì—ëŠ” \*\*\*\*ì°¨íŠ¸ì™€ ê¸°ë³¸ì  ë¶„ì„ ì˜ì—­,
3. **ì˜¤ë¥¸ìª½**: ì—ëŠ” ê¸°ìˆ ì  ë¶„ì„ê³¼ ë‰´ìŠ¤ ë¶„ì„ ì˜ì—­ì„ ë°°ì¹˜í•©ë‹ˆë‹¤.

### Streamlitì„ í™œìš©í•œ ë ˆì´ì•„ì›ƒ êµ¬í˜„

ì´ì œ Streamlitì„ ì´ìš©í•´ ì´ ë ˆì´ì•„ì›ƒì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

Streamlitì—ì„œ ë ˆì´ì•„ì›ƒì€ container(), columns() ë©”ì„œë“œë¥¼ ì´ìš©í•´ êµ¬ì„±í•  ìˆ˜ ìˆì–´ìš”.

- ì½”ë“œ: st.container(), st.columns() ì˜ˆì‹œ

  ```python
  # ì»¨íŠ¸ë¡¤ ì˜ì—­
  container_control = st.container()
  with container_control:
      st.subheader("ğŸ” ê²€ìƒ‰ & ì»¨íŠ¸ë¡¤")
      # ì—¬ê¸°ì— ì»¨íŠ¸ë¡¤ ìš”ì†Œë“¤ ì¶”ê°€

  # ë©”ì¸ ì½˜í…ì¸  ì˜ì—­
  container_content = st.container()
  with container_content:
      col_left, col_right = st.columns([main_left_ratio, main_right_ratio])

      # ì™¼ìª½ ì—´ - ì°¨íŠ¸ ë° ê¸°ë³¸ ì§€í‘œ
      with col_left:
          container_chart = st.container()
          with container_chart:
              ###
              # ì—¬ê¸°ì— ì°¨íŠ¸ ì˜ì—­ ì½”ë“œ #
              ###

          container_fund = st.container()
          with container_fund:
              col_fund_1, col_fund_2, col_fund_3 = st.columns([col1_ratio, col2_ratio, col3_ratio])
              ###
              # ì—¬ê¸°ì— ê¸°ë³¸ ë¶„ì„ ì˜ì—­ ì½”ë“œ #
              ###

      # ì˜¤ë¥¸ìª½ ì—´ - ë³´ê³ ì„œ
      with col_right:
          container_tech = st.container()
          with container_tech:
              ###
              # ì—¬ê¸°ì— ê¸°ìˆ  ë¶„ì„ ì˜ì—­ ì½”ë“œ #
              ###

          container_news = st.container()
          with container_news:
              ###
              # ì—¬ê¸°ì— ë‰´ìŠ¤ ë¶„ì„ ì˜ì—­ ì½”ë“œ #
              ###
  ```

ì—¬ê¸°ì„œ `st.container()`ëŠ” ì„¸ë¡œë¡œ ìŒ“ì´ëŠ” ì˜ì—­ì„, `st.columns()`ëŠ” ê°€ë¡œë¡œ ë‚˜ë€íˆ ë°°ì¹˜ë˜ëŠ” ì˜ì—­ì„ ìƒì„±í•©ë‹ˆë‹¤.

columns()ì—ì„œ ì¸ìë¡œ ë“¤ì–´ê°€ëŠ” ê°’(ì˜ˆ: `main_left_ratio`, `col1_ratio` ë“±)ì€ ê° ì—´ì˜ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´,

```json
col1, col2 = st.columns([2, 1])
```

ì´ëŸ° ì½”ë“œëŠ” í­ì´ 2:1ì˜ ë¹„ìœ¨ì„ ê°€ì§„ ë‘ ì—´ì„ ìƒì„±í•©ë‹ˆë‹¤.

ì´ ë¹„ìœ¨ì€ ì‚¬ìš©ìì˜ ì„ í˜¸ì— ë§ê²Œ ì¡°ì •í•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2. ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬

ì´ì œ ì»¨íŠ¸ë¡¤ ì˜ì—­ì— ì‚¬ìš©ì ì…ë ¥ì„ ë°›ì„ ìš”ì†Œë“¤ì„ ì¶”ê°€í•´ë³´ê² ìŠµë‹ˆë‹¤.

ìƒì„±í•œ ì»¨í…Œì´ë„ˆì— í•„ìš”í•œ ê¸°ëŠ¥ì€ withë¬¸ ì•ˆì—ì„œ êµ¬í˜„í•©ë‹ˆë‹¤.

```python
with container_control:
    st.subheader("ğŸ” ê²€ìƒ‰ & ì»¨íŠ¸ë¡¤")

    # ì‹œì¥ ì„ íƒ
    market = st.selectbox("ì‹œì¥ ì„ íƒ", ["êµ­ë‚´", "í•´ì™¸"])
    market = "dom" if market == "êµ­ë‚´" else "ovs"

    # ì¢…ëª© ì½”ë“œ ì…ë ¥
    stock_code = st.text_input("ì¢…ëª© ì½”ë“œ ì…ë ¥", "005930")

    # ì¡°íšŒ ê¸°ê°„ ì„¤ì •
    date_range = st.date_input(
        "ì°¨íŠ¸ ì¡°íšŒ ê¸°ê°„ ì„ íƒ",
        [datetime.now() - timedelta(days=180), datetime.now()]
    )

    # ë²„íŠ¼ ì˜ì—­
    col_btn1, col_btn2 = st.columns([0.5, 0.5])
    with col_btn1:
        overwrite = st.checkbox("ë³´ê³ ì„œ ë®ì–´ì“°ê¸°", value=False)
        if st.button("ë°ì´í„° ì¡°íšŒ"):
            # ë°ì´í„° ì¡°íšŒ ë¡œì§
            pass

    with col_btn2:
        if st.button("ì´ˆê¸°í™”"):
            # ì´ˆê¸°í™” ë¡œì§
            pass

```

Streamlitì—ì„œ ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ëŠ” ë²„íŠ¼, ì²´í¬ë°•ìŠ¤ ë“±ì„ ìœ„ì ¯ì´ë¼ê³  í•˜ëŠ”ë°ìš”,

ì£¼ìš” ì…ë ¥ ìœ„ì ¯ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- `st.selectbox()`: ì…€ë ‰íŠ¸ ë°•ìŠ¤ëŠ” ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¡œ ì—¬ëŸ¬ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ê³ , _â†’ 85_
- `st.text_input()`: í…ìŠ¤íŠ¸ ì¸í’‹ì€ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ë°›ëŠ” í•„ë“œì…ë‹ˆë‹¤. _â†’ 87_
- `st.date_input()`: ë°ì´íŠ¸ ì¸í’‹ì€ ë‚ ì§œë¥¼ ì„ íƒí•˜ëŠ” í•„ë“œê³ , (ë‹¬ë ¥ UI ì œê³µ) _â†’ 88_
- `st.checkbox()`: ì²´í¬ë°•ìŠ¤, _â†’ 108_
- `st.button()`: í´ë¦­ ê°€ëŠ¥í•œ ë²„íŠ¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. _â†’ 109_

ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒ ì½”ë“œì—ì„œ selectbox(ì…€ë ‰íŠ¸ ë°•ìŠ¤) ìœ„ì ¯ì€ â€˜ì‹œì¥ ì„ íƒâ€™ ì´ë¼ëŠ” ë ˆì´ë¸”ê³¼ í•¨ê»˜,

â€˜êµ­ë‚´â€™, â€˜í•´ì™¸â€™ë¼ëŠ” ì˜µì…˜ ì¤‘ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆê²Œ í•˜ê³ , ì„ íƒ ê²°ê³¼ë¥¼ market(ë§ˆì¼“) ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ text_input(í…ìŠ¤íŠ¸ ì¸í’‹)ì€ â€˜ì¢…ëª© ì½”ë“œ ì…ë ¥â€™ì„ ë°›ì•„, stock_code(ìŠ¤íƒ ì½”ë“œ) ë³€ìˆ˜ì— ì €ì¥í•˜ê³ ,

date_input(ë°ì´íŠ¸ ì¸í’‹)ì€ date_range(ë°ì´íŠ¸ ë ˆì¸ì§€) ë³€ìˆ˜ì— â€˜ì°¨íŠ¸ ì¡°íšŒ ê¸°ê°„â€™ì„ ì €ì¥í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œ ë°›ì€ ë³€ìˆ˜ë“¤ì€ ëŒ€ì‹œë³´ë“œì— í‘œì‹œí•  ë°ì´í„°ì™€ ë³´ê³ ì„œë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œì—ì„œ ë§¤ê°œë³€ìˆ˜ë¡œ ì‚¬ìš©í•˜ëŠ”ê±°ì£ .

- ì½”ë“œ: st ì…ë ¥ ìœ„ì ¯, ë³€ìˆ˜ ì „ë‹¬ ì˜ˆì‹œ

  ```python
  market = st.selectbox("ì‹œì¥ ì„ íƒ", ["êµ­ë‚´", "í•´ì™¸"])
  market = "dom" if market == "êµ­ë‚´" else "ovs"
  stock_code = st.text_input("ì¢…ëª© ì½”ë“œ ì…ë ¥", "AAPL")
  date_range = st.date_input(
      "ì°¨íŠ¸ ì¡°íšŒ ê¸°ê°„ ì„ íƒ", [datetime.now() - timedelta(days=180), datetime.now()]
  )

  ...
  ```

  ```python
  tech_analysis.get_rich_chart(market, stock_code, date_range)

  ...
  ```

ì´ ë•Œ, ì‚¬ìš©ìê°€ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì¢…ëª©ì½”ë“œë¥¼ ì…ë ¥í•  ìˆ˜ë„ ìˆìœ¼ë‹ˆ, try-exceptë¬¸ì„ í™œìš©í•´ ì´ë¥¼ ê²€ì¦í•˜ëŠ” ì½”ë“œë„ ì¶”ê°€í•©ë‹ˆë‹¤.

- ì½”ë“œ: ì¢…ëª©ì½”ë“œ ê²€ì¦
  ```python
  try:
      # ì¢…ëª©ì½”ë“œ -> ê¸°ì—…ëª… ì¡°íšŒ ì‹œë„
      company_name = FinancialsFetcher().ticker_to_company_name(market, stock_code)
  except Exception as e:
      # ì—†ëŠ” ì¢…ëª©ì½”ë“œì¼ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
      error_msg_container = st.container()
      with error_msg_container:
          st.error(f"{e} ì¢…ëª© ì½”ë“œë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.")
      st.session_state["fetched"] = False
  ```

## 3. asyncio: ë¹„ë™ê¸° ë™ì‹œ ì²˜ë¦¬

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì´ìŠˆê°€ í•˜ë‚˜ ìˆìŠµë‹ˆë‹¤.

ìš°ë¦¬ ëŒ€ì‹œë³´ë“œëŠ” ì°¨íŠ¸ ë°ì´í„°, ì¬ë¬´ ì§€í‘œ, AI ë³´ê³ ì„œ ë“± ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ë°,

íŠ¹íˆ AI ë³´ê³ ì„œë¥¼ ì²˜ìŒ ì¡°íšŒí•  ë•ŒëŠ” ì„¸ ê±´ì˜ API í˜¸ì¶œì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— ì‹œê°„ì´ ê½¤ ê±¸ë¦½ë‹ˆë‹¤.

ëª¨ë“  ë°ì´í„°ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ë©´ ì‚¬ìš©ìëŠ” ì˜¤ëœ ì‹œê°„ ê¸°ë‹¤ë ¤ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Pythonì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ `asyncio`ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

~~asyncioëŠ” ì…ì¶œë ¥ ì‘ì—…ì´ ë§ì€ ìƒí™©ì—ì„œ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°(concurrent programming)ì„ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ”ë°ìš”,~~

~~ë™ì‹œì„±ì´ë€ ì—¬ëŸ¬ ì‘ì—…ì„ ë²ˆê°ˆì•„ê°€ë©´ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.~~

í•œ ì‘ì—…ì´ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ì‘ì—…ì„ ì‹œì‘í•˜ì—¬ ì „ì²´ ëŒ€ê¸° ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆì£ .

![image.png](attachment:dc2acd33-017f-44fb-a5f7-7aef641d4e16:image.png)

ì˜ˆë¥¼ ë“¤ì–´, ê¸°ë³¸ì  ë¶„ì„ ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ëŠ” AI ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ê¸°ìˆ ì  ë¶„ì„ì„ ìœ„í•œ ì°¨íŠ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

~~ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì™¸ë¶€ API ì‘ë‹µì„ ëŒ€ê¸°í•˜ëŠ” ë° ì‹œê°„ì´ ë§ì´ ì†Œìš”ë˜ê¸° ë•Œë¬¸ì—,~~

~~ë°”ë¡œ ì´ ëŒ€ê¸°ì‹œê°„ì„ ë‹¤ë¥¸ ì‘ì—…ì„ í•˜ëŠ” ë° í™œìš©í•˜ëŠ”ê±°ì£ .~~

- ~~ë‹¤ë§Œ, ì—¬ëŸ¬ ëŒ€ì˜ CPUê°€ í•œ ë²ˆì— ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë³‘ë ¬parallel í”„ë¡œê·¸ë˜ë°ê³¼ëŠ” ë‹¤ë¥´ë‹¤ëŠ” ì ì€ ìœ ì˜í•´ì£¼ì„¸ìš”~~
  ![image.png](attachment:4fdc2c89-a885-470b-b1c2-1dd2be330f80:610d7cbf-69f6-4b3e-96cb-b9879ac4c0a0.png)

### ë¹„ë™ê¸° ë°ì´í„° ìˆ˜ì§‘ êµ¬í˜„

ê·¸ëŸ¼ ì‹¤ì œ ì½”ë“œë¥¼ í†µí•´ ~~ìˆœì°¨ì (ë™ê¸°ì ) ì²˜ë¦¬ ë°©ì‹ê³¼ ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹ì„ ë¹„êµí•´~~ ë³´ê² ìŠµë‹ˆë‹¤:

- **~~ë™ê¸°ì  ì²˜ë¦¬ (ëŠë¦¼)**:~~
  ```python
  chart = tech_analysis.get_rich_chart(market, stock_code, date_range)
  fund_indicators_table_data = fund_analysis.get_indicators_table_data(market, stock_code)
  fund_indicators_graph_data = fund_analysis.get_indicators_graph_data(market, stock_code)
  fund_report = fund_analysis.get_report(market, stock_code)
  tech_report = tech_analysis.get_report(market, stock_code)
  news_report = news_analysis.get_report(market, stock_code)
  ```
- **ë¹„ë™ê¸° ì²˜ë¦¬ (ë¹ ë¦„)**:

  ```python
  async def fetch_all_data():
      tasks = [
          # ê¸°ìˆ ì  ë¶„ì„ ì°¨íŠ¸
          asyncio.create_task(
              tech_analysis.get_rich_chart(market, stock_code, date_range)
          ),
          # ê¸°ë³¸ ì§€í‘œ í…Œì´ë¸”
          asyncio.create_task(
              fund_analysis.get_indicators_table_data(market, stock_code)
          ),
          # ê¸°ë³¸ ì§€í‘œ ê·¸ë˜í”„
          asyncio.create_task(
              fund_analysis.get_indicators_graph_data(market, stock_code)
          ),
          # ê¸°ë³¸ì  ë¶„ì„ ë³´ê³ ì„œ
          asyncio.create_task(
              fund_analysis.get_report(market, stock_code, overwrite)
          ),
          # ê¸°ìˆ ì  ë¶„ì„ ë³´ê³ ì„œ
          asyncio.create_task(
              tech_analysis.get_report(market, stock_code, overwrite)
          ),
          # ë‰´ìŠ¤ ë¶„ì„ ë³´ê³ ì„œ
          asyncio.create_task(
              news_analysis.get_report(market, stock_code, overwrite)
          ),
      ]

      # ëª¨ë“  íƒœìŠ¤í¬ ë™ì‹œ ì‹¤í–‰ ë° ê²°ê³¼ ìˆ˜ì§‘
      results = await asyncio.gather(*tasks)
      return results
  ```

  ```python
  # ë¹„ë™ê¸° ì‹¤í–‰
  loop = asyncio.new_event_loop()
  asyncio.set_event_loop(loop)

  # ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
  (
      chart,
      fund_indicators_table_data,
      fund_indicators_graph_data,
      fund_report,
      tech_report,
      news_report,
  ) = loop.run_until_complete(fetch_all_data())
  loop.close()

  ```

ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œëŠ”:

1. `asyncio.create_task()` ê° ì‘ì—…ì„ íƒœìŠ¤í¬ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
2. `asyncio.gather()` ê·¸ë¦¬ê³  ê²Œë” í•¨ìˆ˜ë¡œ ëª¨ë“  íƒœìŠ¤í¬ë¥¼ ë™ì‹œì— ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
3. `loop.run_until_complete()`ë§ˆì§€ë§‰ìœ¼ë¡œ ë£¨í”„ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  íƒœìŠ¤í¬ë¥¼ ë™ì‹œì— ìˆ˜í–‰í•˜ë©° ê°ê°ì´ ëª¨ë‘ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.

![ì°¸ê³ : ë¹„ë™ê¸° ì²˜ë¦¬ ì„¤ëª…](attachment:d52ab786-eb8b-499c-b44a-9430673ba418:image.png)

ì°¸ê³ : ë¹„ë™ê¸° ì²˜ë¦¬ ì„¤ëª…

ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—…ì„ ì²˜ë¦¬í•˜ë©´ ì „ì²´ ëŒ€ê¸° ì‹œê°„ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 4. session_state ê´€ë¦¬

ë‹¤ìŒì€ ì„¸ì…˜ ìŠ¤í…Œì´íŠ¸ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

Streamlitì€ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì´ ìˆì„ ë•Œë§ˆë‹¤ ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ëŠ” íŠ¹ì„±ì´ ìˆìŠµë‹ˆë‹¤.

ì´ë¡œ ì¸í•´ ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì…ë ¥ê°’ì„ ë³€ê²½í•  ë•Œë§ˆë‹¤ ë³€ìˆ˜ ê°’ì´ ì´ˆê¸°í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ ë„ì›Œ ë†¨ëŠ”ë°,

ë‹¤ìŒ ê²€ìƒ‰ì„ ìœ„í•´ í…ìŠ¤íŠ¸ ì…ë ¥ ë°•ìŠ¤ë¥¼ ì¡°ì‘í•˜ëŠ” ìˆœê°„ ì´ ì°¨íŠ¸ê°€ ì—†ì–´ì ¸ë²„ë¦´ ìˆ˜ ìˆëŠ” ê±°ì£ .

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Streamlitì€ `session_state`ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” í•œ ì„¸ì…˜ ì•ˆì—ì„œ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ì¼ì¢…ì˜ ì €ì¥ì†Œì…ë‹ˆë‹¤.

ì‚¬ìš©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

### session_state ì´ˆê¸°í™”

ì•± ì‹œì‘ ì‹œ í•„ìš”í•œ ìƒíƒœ ë³€ìˆ˜ë“¤ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤:

```python
# ì„¸ì…˜ ìŠ¤í…Œì´íŠ¸ ì´ˆê¸°í™”
if "fetched" not in st.session_state:
    st.session_state["fetched"] = False
if "chart_data" not in st.session_state:
    st.session_state["chart_data"] = None
if "fund_data" not in st.session_state:
    st.session_state["fund_data"] = None
if "tech_data" not in st.session_state:
    st.session_state["tech_data"] = None
if "news_data" not in st.session_state:
    st.session_state["news_data"] = None
```

### ë°ì´í„° ì €ì¥

ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ session_stateì— ì €ì¥í•©ë‹ˆë‹¤:

```python
st.session_state["fetched"] = True
st.session_state["chart_data"] = chart
st.session_state["fund_data"] = {
    "table": fund_indicators_table_data,
    "graph": fund_indicators_graph_data,
    "report": fund_report,
}
st.session_state["tech_data"] = tech_report
st.session_state["news_data"] = news_report
```

ì €ì¥ëœ ë°ì´í„°ëŠ” UI ì—…ë°ì´íŠ¸ê°€ ìˆì–´ë„ ìœ ì§€ë˜ë©°, í•„ìš”í•  ë•Œ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

ì´ë ‡ê²Œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì´ ìˆì–´ë„ ê°™ì€ ë°ì´í„°ë¥¼ ìœ ì§€í•´ ë³´ì—¬ì£¼ë ¤ë©´ session_state ê´€ë¦¬ê°€ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

## 5. ë°ì´í„° ì‹œê°í™” ë° ì¶œë ¥

ì´ì œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼, ê° ì»¨í…Œì´ë„ˆì— ì ì ˆí•˜ê²Œ í‘œì‹œí•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

ë¶„ì„ ëª¨ë“ˆì—ì„œ ì‘ì„±í•œ ë©”ì„œë“œë“¤ì„ ë³´ë©´,

ë°ì´í„°í”„ë ˆì„ì´ë‚˜ í…ìŠ¤íŠ¸ì˜ í˜•ì‹ìœ¼ë¡œ ê²°ê³¼ë¬¼ì„ ë°˜í™˜í–ˆì—ˆì£ .

streamlitì˜ ë˜ ë‹¤ë¥¸ ì¥ì ì€ ë©”ì„œë“œ í•˜ë‚˜ë¡œ ì´ëŸ° ë°ì´í„°ë¥¼ ê¹”ë”í•˜ê²Œ í‘œì‹œí•´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

ë¨¼ì € ë°ì´í„°í”„ë ˆì„ í˜•ì‹ì˜ ê²°ê³¼ë¬¼ì€ ìŠ¤íŠ¸ë¦¼ë¦¿ì˜ ë°ì´í„°í”„ë ˆì„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python
table_data = st.session_state["fund_data"]["table"]
st.dataframe(
    table_data,
    use_container_width=True,
    hide_index=False,
    column_config={
        "ê°’": st.column_config.NumberColumn(
            format="%.2f", help="ì§€í‘œ ê°’"
        )
    },
)
```

ì—¬ê¸°ì„œ ê° ì—´ì˜ í˜•ì‹ì„ ì§€ì •í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥(column_config)í•´ì„œ, ì§€í‘œ ë°ì´í„°ì˜ ì†Œìˆ˜ì  ìë¦¿ìˆ˜ ë“±ì„ ì„¤ì •í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

ë˜ plotly(í”Œëë¦¬) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ê·¸ë¦° ê·¸ë˜í”„ë¥¼ ë˜‘ê°™ì´ í‘œì‹œí•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì°¨íŠ¸ ì˜ì—­(container*chart)ì˜ withë¬¸ ì•ˆì—ì„œ, *â†’ 281\_

ì´ì „ ê°•ì˜ì—ì„œ ì‚¬ìš©í•œ plotly ì°¨íŠ¸ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ í™œìš©í•´ fig ë³€ìˆ˜ì— í”Œë¡¯ ê°ì²´ë¥¼ ì €ì¥í•˜ê³ ,

st.plotly_chart()ì— ì´ ê°ì²´ë¥¼ ë„˜ê²¨ì£¼ë©´

ì›í•˜ëŠ” ì˜ì—­ì— ì°¨íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.

- ì½”ë“œ: st.plotly_chart() ì˜ˆì‹œ (ì°¨íŠ¸ ì˜ì—­)

  ```python
  with container_chart:
  		fig = make_subplots(
  		        rows=2,
  		        cols=1,
  		        shared_xaxes=True,
  		        vertical_spacing=0.1,
  		        row_heights=[0.7, 0.3],
  		    )
  		fig.add_trace(go.Candlestick(...))
  		fig.add_trace(...)

  		...

  		st.plotly_chart(fig, use_container_width=True)
  ```

ë³´ê³ ì„œì™€ ê°™ì€ ~~í…ìŠ¤íŠ¸ í˜•íƒœì˜~~ ë°ì´í„°ëŠ” ë§ˆí¬ë‹¤ìš´ í•¨ìˆ˜(`st.markdown()`)ë¥¼ ì‚¬ìš©í•´ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ì½”ë“œ: st.markdown() ì˜ˆì‹œ (ê¸°ë³¸ë¶„ì„-ë³´ê³ ì„œ ì˜ì—­)
  ```python
  # ê¸°ë³¸ë¶„ì„ë³´ê³ ì„œ:
  # ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë°•ìŠ¤ì— ë³´ê³ ì„œ í‘œì‹œ
  st.markdown(
      f'<div class="scrollable-report">{st.session_state["fund_data"]["report"]}</div>',
      unsafe_allow_html=True,
  )
  ```

(`unsafe_allow_html=True`) ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ HTML íƒœê·¸ë„ í•¨ê»˜ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´, ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë°•ìŠ¤ ë“± ì¶”ê°€ì ì¸ ìŠ¤íƒ€ì¼ë§ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì, ê·¸ëŸ¼ í•œë²ˆ ì‹¤í–‰í•´ ë³¼ê¹Œìš”?

ëª¨ë“  ì½”ë“œ êµ¬í˜„ì„ ë§ˆì³¤ë‹¤ë©´, í„°ë¯¸ë„ì— ìŠ¤íŠ¸ë¦¼ë¦¿ ëŸ° ì•± ë‹· íŒŒì´ë¥¼ ì…ë ¥í•˜ë©´, ì´ë ‡ê²Œ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ëŒ€ì‹œë³´ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤!

ì—¬ê¸°ì„œ ì›í•˜ëŠ” ì¢…ëª©ì„ ì„ íƒí•˜ê³ , ë°ì´í„° ì¡°íšŒ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì ì‹œ ê¸°ë‹¤ë¦¬ë©´,

ì§ ! ìš°ë¦¬ê°€ ì²˜ìŒì— ì›í–ˆë˜ ë°”ë¡œ ê·¸ ëŒ€ì‹œë³´ë“œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤!

(ì˜ìƒ: ìµœì¢… ëŒ€ì‹œë³´ë“œì—ì„œ ìœ„ í•­ëª© ê°ê°ì— í•´ë‹¹í•˜ëŠ” ì˜ì—­ ì¤Œì¸)

ì°¨íŠ¸, ê¸°ë³¸ì  ë¶„ì„ ì§€í‘œì™€ ë³´ê³ ì„œ, ê¸°ìˆ ì  ë¶„ì„ ë³´ê³ ì„œ, ì£¼ìš” ë‰´ìŠ¤ ë¶„ì„ ë³´ê³ ì„œê¹Œì§€ ì˜ ë‚˜ì˜¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë„¤ìš”~!

ì—¬ê¸°ì— ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ì„¸ì…˜ ê´€ë¦¬ê¹Œì§€ ë”í•´ì ¸, ì“°ê¸° í•œê²° í¸í•œ ëŒ€ì‹œë³´ë“œê°€ ë˜ì—ˆë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

## ë§ˆë¬´ë¦¬

ì´ë ‡ê²Œ í•´ì„œ ìš°ë¦¬ì˜ AI ì£¼ì‹ ë¶„ì„ ëŒ€ì‹œë³´ë“œê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!

ì—¬ëŸ¬ë¶„ë„ ì´ í”„ë¡œì íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìì‹ ë§Œì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜, ë‹¤ë¥¸ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì—°ê²°í•´ ë”ìš± ë°œì „ì‹œì¼œ ë³´ì„¸ìš”!

ë¶„ì„ ê²°ê³¼ë¥¼ í† ëŒ€ë¡œ ìë™ë§¤ë§¤ê¹Œì§€ ì‹¤í–‰í•˜ë„ë¡ ë§Œë“¤ì–´ ë³¼ ìˆ˜ë„ ìˆê² ì£ ?

ì—¬ëŸ¬ë¶„ì˜ ë©‹ì§„ í”„ë¡œì íŠ¸ë¥¼ ì‘ì›í•˜ê² ìŠµë‹ˆë‹¤!

ê·¸ë™ì•ˆ ì •ë§ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤!

â†’ ë¦¬ìº¡ ì—†ì´, ì—¬ê¸°ì„œ ë§ˆë¬´ë¦¬í•˜ëŠ” ê±¸ë¡œ

---

### 1ï¸âƒ£ ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ ì„¤ê³„

- Streamlitì„ í™œìš©í•´ ì „ì²´ ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒì„ êµ¬í˜„í•©ë‹ˆë‹¤.
- ëŒ€ì‹œë³´ë“œëŠ” í¬ê²Œ ì„¸ ì˜ì—­ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.
  - ìƒë‹¨ì˜ ì»¨íŠ¸ë¡¤ ì˜ì—­: ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
  - ì½˜í…ì¸  ì˜ì—­ ì™¼ìª½: ì°¨íŠ¸ì™€ ê¸°ë³¸ì  ë¶„ì„
  - ì½˜í…ì¸  ì˜ì—­ ì˜¤ë¥¸ìª½: ê¸°ìˆ ì  ë¶„ì„ê³¼ ë‰´ìŠ¤ ë¶„ì„

```python
# ì»¨íŠ¸ë¡¤ ì˜ì—­
container_control = st.container()
with container_control:
    st.subheader("ğŸ” ê²€ìƒ‰ & ì»¨íŠ¸ë¡¤")
    # ì»¨íŠ¸ë¡¤ ìš”ì†Œ ì¶”ê°€

# ë©”ì¸ ì½˜í…ì¸  ì˜ì—­
container_content = st.container()
with container_content:
    col_left, col_right = st.columns([main_left_ratio, main_right_ratio])

    # ì™¼ìª½ ì—´ - ì°¨íŠ¸ ë° ê¸°ë³¸ ë¶„ì„
    with col_left:
        container_chart = st.container()
        with container_chart:
            # ì°¨íŠ¸ ì˜ì—­ ì½”ë“œ #

        container_fund = st.container()
        with container_fund:
            # ê¸°ë³¸ ë¶„ì„ ì˜ì—­ ì½”ë“œ #

    # ì˜¤ë¥¸ìª½ ì—´ - ê¸°ìˆ , ë‰´ìŠ¤ ë¶„ì„ ë³´ê³ ì„œ
    with col_right:
        container_tech = st.container()
        with container_tech:
            # ê¸°ìˆ  ë¶„ì„ ì˜ì—­ ì½”ë“œ #

        container_news = st.container()
        with container_news:
            # ë‰´ìŠ¤ ë¶„ì„ ì˜ì—­ ì½”ë“œ #
```

<aside>
â•

**Streamlit ë ˆì´ì•„ì›ƒ í•¨ìˆ˜ ì˜ˆì‹œ**

- st.container(): ì„¸ë¡œë¡œ ìŒ“ì´ëŠ” ì»¨í…Œì´ë„ˆ ì˜ì—­ ìƒì„±
  - st.container(border=True): í…Œë‘ë¦¬ë¥¼ ê°€ì§„ ì»¨í…Œì´ë„ˆ ì˜ì—­ ìƒì„±
  - st.container(height=120): ë†’ì´ê°€ 120í”½ì…€ë¡œ ì§€ì •ëœ ì»¨í…Œì´ë„ˆ ì˜ì—­ ìƒì„±
- st.columns(): ê°€ë¡œë¡œ ë‚˜ë€íˆ ë°°ì¹˜ë˜ëŠ” ì»¨í…Œì´ë„ˆ ì—´ ìƒì„± - st.columns(2): ë™ì¼í•œ í­ì˜ ì»¨í…Œì´ë„ˆ 2ê°œ ìƒì„± - st.columns([2, 1]): 2:1 ë¹„ìœ¨ì˜ í­ì„ ê°€ì§„ ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆ ìƒì„±
</aside>

### 2ï¸âƒ£ ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬

- Streamlit ìœ„ì ¯ì„ í™œìš©í•´ ì‚¬ìš©ì ì…ë ¥ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

```python
with container_control:
    st.subheader("ğŸ” ê²€ìƒ‰ & ì»¨íŠ¸ë¡¤")

    # ì‹œì¥ ì„ íƒ
    market = st.selectbox("ì‹œì¥ ì„ íƒ", ["êµ­ë‚´", "í•´ì™¸"])
    market = "dom" if market == "êµ­ë‚´" else "ovs"

    # ì¢…ëª© ì½”ë“œ ì…ë ¥
    stock_code = st.text_input("ì¢…ëª© ì½”ë“œ ì…ë ¥", "005930")

    # ì¡°íšŒ ê¸°ê°„ ì„¤ì •
    date_range = st.date_input(
        "ì°¨íŠ¸ ì¡°íšŒ ê¸°ê°„ ì„ íƒ",
        [datetime.now() - timedelta(days=180), datetime.now()]
    )

    # ë²„íŠ¼ ì˜ì—­
    col_btn1, col_btn2 = st.columns([0.5, 0.5])
    with col_btn1:
        overwrite = st.checkbox("ë³´ê³ ì„œ ë®ì–´ì“°ê¸°", value=False)
        if st.button("ë°ì´í„° ì¡°íšŒ"):
            # ë°ì´í„° ì¡°íšŒ ë¡œì§ #
            pass

    with col_btn2:
        if st.button("ì´ˆê¸°í™”"):
            # ì´ˆê¸°í™” ë¡œì§ #
            pass
```

- ì…ë ¥ëœ ì¢…ëª©ì½”ë“œì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.

```python
try:
    # ì¢…ëª©ì½”ë“œ -> ê¸°ì—…ëª… ì¡°íšŒ ì‹œë„
    company_name = FinancialsFetcher().ticker_to_company_name(market, stock_code)
except Exception as e:
    # ì—†ëŠ” ì¢…ëª©ì½”ë“œì¼ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    error_msg_container = st.container()
    with error_msg_container:
        st.error(f"{e} ì¢…ëª© ì½”ë“œë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    st.session_state["fetched"] = False
```

<aside>
â•

**Streamlit ì£¼ìš” ìœ„ì ¯**

- st.selectbox(): ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¡œ ì—¬ëŸ¬ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒ
- st.text_input(): í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ
- st.date_input(): ë‚ ì§œ ì„ íƒ í•„ë“œ(ë‹¬ë ¥ UI ì œê³µ)
- st.checkbox(): ì²´í¬ë°•ìŠ¤
- st.button(): í´ë¦­ ê°€ëŠ¥í•œ ë²„íŠ¼
</aside>

### 3ï¸âƒ£ asyncioë¥¼ í™œìš©í•œ ë¹„ë™ê¸° ì²˜ë¦¬

- ì—¬ëŸ¬ ë°ì´í„° ì¡°íšŒì™€ API í˜¸ì¶œì„ ë™ì‹œì— ì²˜ë¦¬í•˜ë©´ ëŒ€ê¸° ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Pythonì˜ asyncio ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

```python
async def fetch_all_data():
    tasks = [
        # ê¸°ìˆ ì  ë¶„ì„ ì°¨íŠ¸
        asyncio.create_task(
            tech_analysis.get_rich_chart(market, stock_code, date_range)
        ),
        # ê¸°ë³¸ ì§€í‘œ í…Œì´ë¸”
        asyncio.create_task(
            fund_analysis.get_indicators_table_data(market, stock_code)
        ),
        # ê¸°ë³¸ ì§€í‘œ ê·¸ë˜í”„
        asyncio.create_task(
            fund_analysis.get_indicators_graph_data(market, stock_code)
        ),
        # ê¸°ë³¸ì  ë¶„ì„ ë³´ê³ ì„œ
        asyncio.create_task(
            fund_analysis.get_report(market, stock_code, overwrite)
        ),
        # ê¸°ìˆ ì  ë¶„ì„ ë³´ê³ ì„œ
        asyncio.create_task(
            tech_analysis.get_report(market, stock_code, overwrite)
        ),
        # ë‰´ìŠ¤ ë¶„ì„ ë³´ê³ ì„œ
        asyncio.create_task(
            news_analysis.get_report(market, stock_code, overwrite)
        ),
    ]

    # ëª¨ë“  íƒœìŠ¤í¬ ë™ì‹œ ì‹¤í–‰ ë° ê²°ê³¼ ìˆ˜ì§‘
    results = await asyncio.gather(*tasks)
    return results
```

- asyncio ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì„¤ì •í•˜ê³  ê²°ê³¼ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

```python
# ë¹„ë™ê¸° ì‹¤í–‰
loop = asyncio.new_event_loop()
asyncio.set_event_loop(loop)

# ê²°ê³¼ ëª¨ìœ¼ê¸°
(
    chart,
    fund_indicators_table_data,
    fund_indicators_graph_data,
    fund_report,
    tech_report,
    news_report,
) = loop.run_until_complete(fetch_all_data())
loop.close()
```

<aside>
âš ï¸

**ì—¬ê¸°ì„œ ì ê¹!**

- ë™ì‹œì„±(Concurrency)ê³¼ ë³‘ë ¬ì„±(Parallelism)ì€ ë‹¤ë¥¸ ê°œë…ì…ë‹ˆë‹¤.
  - ë™ì‹œì„±: ì—¬ëŸ¬ ì‘ì—…ì„ ë²ˆê°ˆì•„ê°€ë©° ì‹¤í–‰í•˜ëŠ” ê²ƒ (ë‹¨ì¼ ì½”ì–´ì—ì„œë„ ê°€ëŠ¥)
  - ë³‘ë ¬ì„±: ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì‹¤í–‰í•˜ëŠ” ê²ƒ (ë©€í‹° ì½”ì–´ì—ì„œë§Œ ê°€ëŠ¥)
- asyncioëŠ” ë™ì‹œì„±ì„ êµ¬í˜„í•©ë‹ˆë‹¤. íŠ¹íˆ I/O ì‘ì—…(API í˜¸ì¶œ, íŒŒì¼ ì½ê¸° ë“±)ì´ ë§ì„ ë•Œ íš¨ìœ¨ì ì…ë‹ˆë‹¤.
- ì…ì¶œë ¥ ìœ„ì£¼ì˜ ì‘ì—…ì—ëŠ” asyncioê°€ ì í•©í•˜ê³ , CPUë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì‘ì—…(ê³„ì‚°ì´ ë§ì€ ì‘ì—…)ì—ëŠ” ë³‘ë ¬ í”„ë¡œê·¸ë˜ë°ì´ ë” ì í•©í•©ë‹ˆë‹¤.
</aside>

### 4ï¸âƒ£ session_state ê´€ë¦¬

- Streamlitì€ í´ë¦­, í‚¤ë³´ë“œ ì…ë ¥ê³¼ ê°™ì€ ìƒí˜¸ì‘ìš© ì‹œ ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ë¥¼ ë§¤ë²ˆ ë‹¤ì‹œ ì‹¤í–‰í•˜ë¯€ë¡œ, ë³€ìˆ˜ì˜ ìƒíƒœë¥¼ ë”°ë¡œ ê´€ë¦¬í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
- Streamlitì—ì„œ ì„¸ì…˜ ìƒíƒœ(`st.session_state`)ëŠ” ìƒí˜¸ì‘ìš©ì´ ìˆì–´ë„ ê°’ì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - ìƒí˜¸ì‘ìš©ì´ ìˆì–´ë„ ìœ ì§€ë˜ì–´ì•¼ í•˜ëŠ” ë°ì´í„°ëŠ” ì„¸ì…˜ ìƒíƒœì— ë”°ë¡œ ì €ì¥í•´ë‘ë©´ ë©ë‹ˆë‹¤.
  - ë°ì´í„°ì˜ ê°’ì€ ì•±ì„ ìµœì´ˆ ì‹¤í–‰í•  ë•Œ ì´ˆê¸°í™”í•´ì¤ë‹ˆë‹¤.

```python
# ì„¸ì…˜ ìŠ¤í…Œì´íŠ¸ ì´ˆê¸°í™”
if "fetched" not in st.session_state:
    st.session_state["fetched"] = False
if "chart_data" not in st.session_state:
    st.session_state["chart_data"] = None
if "fund_data" not in st.session_state:
    st.session_state["fund_data"] = None
if "tech_data" not in st.session_state:
    st.session_state["tech_data"] = None
if "news_data" not in st.session_state:
    st.session_state["news_data"] = None
```

- ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ë³€ê²½í•  ë•Œë§ˆë‹¤ ê°’ì´ ìœ ì§€ë˜ë„ë¡ ì„¸ì…˜ ìƒíƒœì— ì €ì¥í•©ë‹ˆë‹¤.

```python
st.session_state["fetched"] = True
st.session_state["chart_data"] = chart
st.session_state["fund_data"] = {
    "table": fund_indicators_table_data,
    "graph": fund_indicators_graph_data,
    "report": fund_report,
}
st.session_state["tech_data"] = tech_report
st.session_state["news_data"] = news_report
```

<aside>
â•

**Streamlit ì„¸ì…˜ ìƒíƒœ í™œìš© íŒ**

- ë³µì¡í•œ ë°ì´í„°ëŠ” JSON ì§ë ¬í™”ê°€ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ì €ì¥í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
- ì„¸ì…˜ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ëŠ” ì¡°ê±´ë¬¸ì„ í™œìš©í•˜ë©´ íš¨ìœ¨ì ì¸ ë°ì´í„° ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- í•„ìš”í•œ ê²½ìš° ì„¸ì…˜ ìƒíƒœë¥¼ ëª¨ë‘ ì´ˆê¸°í™”(st.session_state.clear())í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</aside>

<aside>
â•

**Streamlit ìºì‹œ í™œìš© ë°©ë²•**

- ë°˜ë³µí•´ì„œ ì‹¤í–‰í•˜ê²Œ ë˜ëŠ” í•¨ìˆ˜ëŠ” ìºì‹œ ë°ì½”ë ˆì´í„°ë¡œ ë°˜í™˜ ê²°ê³¼ë¥¼ ìºì‹±í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- `@st.cache_data`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ, ë³µì¡í•œ ê³„ì‚° ê²°ê³¼ì— ì í•©í•©ë‹ˆë‹¤.

```python
# ì–´ë ˆì´ ë§ì…ˆ í•¨ìˆ˜
# ì´ì „ í˜¸ì¶œ ê²°ê³¼ì™€ ì¼ì¹˜í•˜ë©´, ì—¬ëŸ¬ ë²ˆ ê³„ì‚°í•˜ëŠ” ëŒ€ì‹  ìºì‹œëœ ê°’ì˜ ì‚¬ë³¸ì„ ë°˜í™˜
@st.cache_data
def add(arr1, arr2):
	return arr1 + arr2
```

- `@st.cache_resource`ëŠ” ë§¤ë²ˆ ì‚¬ë³¸ì„ ìƒì„±í•˜ì§€ ì•Šì•„ì„œ, ìš©ëŸ‰ì´ í° ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì´ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì˜ ì—°ê²° ê´€ê³„ë¥¼ ìºì‹±í•˜ëŠ” ë° ì í•©í•©ë‹ˆë‹¤.

```python
# ê¸°ìˆ  ë¶„ì„ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜
# ìµœì´ˆ ì‹¤í–‰ ì‹œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ì´í›„ì—ëŠ” ìºì‹œ ë°˜í™˜
@st.cache_resource
def get_tech_analysis():
	return TechnicalAnalysis()
```

</aside>

### 5ï¸âƒ£ ë°ì´í„° ì‹œê°í™” ë° ì¶œë ¥

- ë‹¤ì–‘í•œ Streamlit ì»´í¬ë„ŒíŠ¸ë¥¼ í™œìš©í•´ ë°ì´í„°ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.
- DataFrame ë³€ìˆ˜ëŠ” `st.dataframe()`ì„ ì´ìš©í•´ í‘œ í˜•ì‹ìœ¼ë¡œ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
# ì¬ë¬´ ì§€í‘œ í…Œì´ë¸” í‘œì‹œ
table_data = st.session_state["fund_data"]["table"]
st.dataframe(
    table_data,
    use_container_width=True,
    hide_index=False,
    column_config={
        "ê°’": st.column_config.NumberColumn(
            format="%.2f", help="ì§€í‘œ ê°’"
        )
    },
)
```

- `st.plotly_chart()`ëŠ” ë°ì´í„°ë¥¼ ìƒí˜¸ì‘ìš© ê°€ëŠ¥í•œ ê·¸ë˜í”„ë¡œ í‘œì‹œí•´ ì¤ë‹ˆë‹¤.

```python
# ì°¨íŠ¸ ë°ì´í„° í‘œì‹œ
with container_chart:
		# Plotly ê°ì²´ ìƒì„±
		fig = make_subplots(
		        rows=2,
		        cols=1,
		        shared_xaxes=True,
		        vertical_spacing=0.1,
		        row_heights=[0.7, 0.3],
		    )
    # ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ ì¶”ê°€
		fig.add_trace(go.Candlestick(...))
		# ì´ë™í‰ê· ì„  ì¶”ê°€
		fig.add_trace(...)

		...

		# ìŠ¤íŠ¸ë¦¼ë¦¿ì— ì°¨íŠ¸ í‘œì‹œ
		st.plotly_chart(fig, use_container_width=True)
```

- ë³´ê³ ì„œ í…ìŠ¤íŠ¸ëŠ” `st.markdown()`ì„ ì´ìš©í•´ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

```python
# ì˜ˆì‹œ: ê¸°ë³¸ ë¶„ì„ ë³´ê³ ì„œ
# ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë°•ìŠ¤ì— ë³´ê³ ì„œ í‘œì‹œ
st.markdown(
    f'<div class="scrollable-report">{st.session_state["fund_data"]["report"]}</div>',
    unsafe_allow_html=True,
)
```

<aside>
â•

**Streamlit ì£¼ìš” ì‹œê°í™” ì»´í¬ë„ŒíŠ¸**

- st.dataframe(): ë°ì´í„°í”„ë ˆì„ì„ í‘œë¡œ í‘œì‹œ
- st.plotly_chart(): Plotly ê·¸ë˜í”„ ê°ì²´ë¥¼ í‘œì‹œ
- st.markdown(): ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œ
  - unsafe_allow_html=True ì˜µì…˜ìœ¼ë¡œ HTML íƒœê·¸ ì‚¬ìš© ê°€ëŠ¥
- st.line_chart(), st.bar_chart(): ì„  ê·¸ë˜í”„, ë§‰ëŒ€ ê·¸ë˜í”„ ë“± ë‚´ì¥ ì°¨íŠ¸ ìš”ì†Œ í‘œì‹œ
</aside>
